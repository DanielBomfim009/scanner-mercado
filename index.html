<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Scanner de Compras</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/quagga@0.12.1/dist/quagga.min.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:15px;
}
.app{
  max-width:420px;
  margin:auto;
  background:#fff;
  border-radius:12px;
  padding:15px;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
}
h2{text-align:center;margin-top:0}
#camera{
  width:100%;
  height:240px;
  background:#000;
  border-radius:10px;
  overflow:hidden;
  margin-bottom:10px;
}
video{
  width:100%;
  height:100%;
  object-fit:cover;
}
button{
  width:100%;
  padding:12px;
  margin-top:8px;
  font-size:16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.start{background:#28a745;color:#fff}
.stop{background:#dc3545;color:#fff}
.total{
  margin-top:15px;
  font-size:18px;
  font-weight:bold;
  text-align:center;
}
.lista{
  margin-top:10px;
  font-size:14px;
}
</style>
</head>

<body>
<div class="app">
  <h2>üõí Compras do M√™s</h2>

  <div id="camera"></div>

  <button class="start" onclick="iniciarScanner()">‚ñ∂ Abrir C√¢mera</button>
  <button class="stop" onclick="pararScanner()">‚èπ Parar</button>

  <div class="lista" id="lista"></div>
  <div class="total" id="total">Total: R$ 0,00</div>
</div>

<script>
let produtos = JSON.parse(localStorage.getItem("produtos")) || {};
let carrinho = [];
let total = 0;
let lendo = false;

function iniciarScanner(){
  Quagga.init({
    inputStream:{
      type:"LiveStream",
      target:document.querySelector("#camera"),
      constraints:{
        facingMode:"environment"
      }
    },
    decoder:{
      readers:["ean_reader","ean_13_reader","code_128_reader"]
    }
  },err=>{
    if(err){alert("Erro ao abrir c√¢mera");return;}
    Quagga.start();
  });

  Quagga.onDetected(data=>{
    if(lendo) return;
    lendo = true;

    const codigo = data.codeResult.code;
    processarCodigo(codigo);

    setTimeout(()=>lendo=false,1500);
  });
}

function pararScanner(){
  Quagga.stop();
}

function processarCodigo(codigo){
  if(produtos[codigo]){
    // Produto j√° cadastrado
    let qtd = prompt(`Quantidade (${produtos[codigo].unidade})`);
    if(!qtd) return;

    let subtotal = qtd * produtos[codigo].preco;
    total += subtotal;

    carrinho.push(`${produtos[codigo].nome} (${qtd} ${produtos[codigo].unidade}) - R$ ${subtotal.toFixed(2)}`);
    atualizarTela();
  }else{
    // Novo cadastro
    let nome = prompt("Nome do produto:");
    if(!nome) return;

    let preco = parseFloat(prompt("Pre√ßo (ex: 12.50)"));
    if(!preco) return;

    let unidade = prompt("Unidade (UN ou KG)").toUpperCase();
    if(unidade !== "UN" && unidade !== "KG"){
      alert("Use UN ou KG");
      return;
    }

    produtos[codigo] = {nome,preco,unidade};
    localStorage.setItem("produtos",JSON.stringify(produtos));

    alert("Produto cadastrado! Escaneie novamente para adicionar ao carrinho.");
  }
}

function atualizarTela(){
  document.getElementById("lista").innerHTML = carrinho.join("<br>");
  document.getElementById("total").innerText = `Total: R$ ${total.toFixed(2)}`;
}
</script>
</body>
</html>
