<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Compras do m√™s</title>

<!-- ZXING BARCODE SCANNER -->
<script src="https://unpkg.com/@zxing/library@latest"></script>

<style>
body{
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f7ff;
  margin:0;
}

.container{
  max-width:900px;
  margin:0 auto;
  padding:14px;
}

/* LOGO */
.logo-box{
  text-align:center;
  margin-top:10px;
}
.logo-box img{
  width:120px;
  height:120px;
  border-radius:50%;
  object-fit:cover;
  border:4px solid #2d7bff;
}

/* TITULO */
h1{
  text-align:center;
}

/* CARDS */
.card{
  background:white;
  padding:16px;
  border-radius:18px;
  margin-top:12px;
  box-shadow:0 8px 30px rgba(0,0,0,.08);
}

/* BUTTONS */
button{
  width:100%;
  padding:14px;
  font-size:16px;
  border:none;
  border-radius:14px;
  font-weight:bold;
  cursor:pointer;
  margin-top:8px;
}

.primary{background:#1e6bff;color:white;}
.secondary{background:#6c757d;color:white;}
.danger{background:#dd3333;color:white;}
.success{background:#22bb33;color:white;}

/* VIDEO */
video{
  width:100%;
  background:black;
  border-radius:14px;
  margin-top:8px;
}

/* FORM GRID */
.form-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.form-grid input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #ccc;
}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:8px;
  border-bottom:1px solid #ddd;
}
</style>
</head>

<body>

<div class="container">

  <div class="logo-box">
    <img src="logo.jpg">
  </div>

  <h1>üõí Compras do m√™s</h1>

  <!-- SCANNER -->
  <div class="card">
      <button class="primary" id="btnStart">üì∑ Abrir c√¢mera</button>
      <button class="secondary" id="btnStop">‚èπÔ∏è Parar</button>

      <video id="preview" playsinline></video>

      <p><b>C√≥digo detectado:</b> <span id="codigoLido">‚Äî</span></p>
  </div>

  <!-- LISTA -->
  <div class="card">
      <h2>üì¶ Produtos cadastrados</h2>
      <table>
          <thead>
              <tr>
                  <th>C√≥digo</th>
                  <th>Nome</th>
                  <th>Tipo</th>
                  <th>Pre√ßo</th>
                  <th>A√ß√µes</th>
              </tr>
          </thead>
          <tbody id="listaTabela"></tbody>
      </table>
  </div>

  <!-- EDI√á√ÉO -->
  <div class="card">
      <h2>‚úèÔ∏è Edi√ß√£o de produto</h2>

      <div class="form-grid">
          <input id="editCodigo" placeholder="C√≥digo (somente leitura)" disabled>
          <input id="editNome" placeholder="Nome">
          <input id="editTipo" placeholder="Tipo">
          <input id="editPreco" placeholder="Pre√ßo">
      </div>

      <button class="success" onclick="salvarEdicao()">üíæ Salvar altera√ß√µes</button>
  </div>

</div>

<script>
let selectedDeviceId = null;
let codeReader = new ZXing.BrowserMultiFormatReader();
let scanning = false;

/* LOCAL STORAGE */
function getProdutos(){
  return JSON.parse(localStorage.getItem("produtos") || "[]");
}
function salvarProdutos(lista){
  localStorage.setItem("produtos", JSON.stringify(lista));
}

/* RENDER TABLE */
function renderTabela(){
  let tbody = document.getElementById("listaTabela");
  tbody.innerHTML = "";

  getProdutos().forEach(p=>{
    tbody.innerHTML += `
      <tr>
        <td>${p.codigo}</td>
        <td>${p.nome}</td>
        <td>${p.tipo}</td>
        <td>${p.preco}</td>
        <td>
          <button onclick="editar('${p.codigo}')">‚úèÔ∏è</button>
          <button class="danger" onclick="excluir('${p.codigo}')">üóëÔ∏è</button>
        </td>
      </tr>
    `;
  });
}

/* EDITAR */
function editar(codigo){
  let p = getProdutos().find(x=>x.codigo==codigo);
  if(!p) return;

  document.getElementById("editCodigo").value=p.codigo;
  document.getElementById("editNome").value=p.nome;
  document.getElementById("editTipo").value=p.tipo;
  document.getElementById("editPreco").value=p.preco;
}

function salvarEdicao(){
  let lista = getProdutos();

  let codigo = document.getElementById("editCodigo").value;

  let idx = lista.findIndex(x=>x.codigo==codigo);

  if(idx>=0){
    lista[idx].nome = document.getElementById("editNome").value;
    lista[idx].tipo = document.getElementById("editTipo").value;
    lista[idx].preco = document.getElementById("editPreco").value;
  }

  salvarProdutos(lista);
  renderTabela();
  alert("Altera√ß√µes salvas");
}

/* EXCLUIR */
function excluir(codigo){
  salvarProdutos(getProdutos().filter(p=>p.codigo!=codigo));
  renderTabela();
}

/* SCAN */
document.getElementById("btnStart").onclick = async ()=>{

  scanning = true;

  const cams = await codeReader.listVideoInputDevices();

  if(cams.length==0){
    alert("Nenhuma c√¢mera encontrada");
    return;
  }

  selectedDeviceId = cams[cams.length-1].deviceId;

  codeReader.decodeFromVideoDevice(selectedDeviceId,"preview",(result,err)=>{
    if(result){
      let code = result.text;
      document.getElementById("codigoLido").innerText = code;

      let lista = getProdutos();
      let existe = lista.find(p=>p.codigo==code);

      if(existe){
        editar(code);
      }else{
        let nome = prompt("Produto novo! Digite o nome:");
        let tipo = prompt("Tipo:");
        let preco = prompt("Pre√ßo:");

        lista.push({codigo:code,nome,tipo,preco});
        salvarProdutos(lista);
        renderTabela();
        alert("Produto cadastrado");
      }
    }
  });
};

document.getElementById("btnStop").onclick = ()=>{
  codeReader.reset();
};

renderTabela();
</script>

</body>
</html>
