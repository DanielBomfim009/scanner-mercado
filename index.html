<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>GoL BUY SMART - Compras do m√™s</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://unpkg.com/@zxing/library@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary:#3b7ddd;--secondary:#ffb703;--background:#eef3ff;
  --card-bg:#ffffff;--text-dark:#1a1a1a;--text-light:#ffffff;--danger:#ff3b3b;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Roboto',sans-serif;}
body{background:var(--background);}
.container{max-width:900px;margin:auto;padding:12px;}
.logo{text-align:center;margin-top:20px;}
.logo img{width:200px;height:200px;border-radius:50%;border:5px solid #fff;box-shadow:0 10px 30px rgba(0,0,0,.35);}
h1{text-align:center;margin:15px 0;color:var(--primary);}
.box{background:#fff;border-radius:18px;padding:20px;margin-top:20px;box-shadow:0 4px 20px rgba(0,0,0,.15);}
button{width:100%;padding:14px;border:none;font-size:16px;border-radius:12px;margin-top:10px;cursor:pointer;}
.btnStart{background:var(--primary);color:#fff;}
.btnStop{background:#6b6b6b;color:#fff;}
.toggleBtn{background:var(--secondary);}
#camera{width:100%;height:260px;background:#000;border-radius:18px;margin-top:12px;overflow:hidden;position:relative;}
#camera video{width:100%;height:100%;object-fit:cover;}
.scan-line{position:absolute;left:0;right:0;height:2px;background:red;animation:scan 2s linear infinite;}
@keyframes scan{0%{top:10%}50%{top:90%}100%{top:10%}}
input,select{width:100%;padding:12px;border-radius:12px;border:1px solid #ccc;margin-top:6px;font-size:15px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
td,th{padding:10px;text-align:center;}
tr:nth-child(even){background:#f5f5f5;}

#carrinhoIcone{
  position:fixed;left:18px;bottom:18px;width:70px;height:70px;border-radius:50%;
  background:var(--primary);color:white;font-size:28px;display:flex;
  align-items:center;justify-content:center;box-shadow:0 8px 20px rgba(0,0,0,.35);
}
#carrinhoIcone span{
  position:absolute;top:-8px;right:-8px;background:red;width:18px;height:18px;
  border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;
}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;}
.modal-content{background:#fff;width:92%;max-width:480px;margin:40px auto;padding:20px;border-radius:18px;}
.total{text-align:right;font-weight:bold;padding-top:10px;}

#cadastroSuspenso,#quantidadeBox{
  position:fixed;bottom:10px;left:50%;transform:translateX(-50%);
  width:90%;max-width:400px;background:white;padding:20px;border-radius:18px;
  box-shadow:0 5px 20px rgba(0,0,0,.3);display:none;z-index:1001;
}
</style>
</head>

<body>

<div class="container" id="mainApp">
  <div class="logo"><img src="logo.png"></div>
  <h1>üõí Compras do m√™s üõçÔ∏è</h1>

  <div class="box">
    <button class="btnStart" id="startButton">üì∏ Abrir c√¢mera</button>
    <button class="btnStop" id="stopButton">‚èπÔ∏è Parar</button>
    <div id="camera">
      <video id="video" playsinline></video>
      <div class="scan-line"></div>
    </div>
    <p><strong>C√≥digo detectado:</strong> <span id="detected">‚Äî</span></p>
    <p id="nomeDetectado"></p>
  </div>
</div>

<div id="carrinhoIcone" onclick="abrirCarrinho()">üõçÔ∏è<span id="badge">0</span></div>

<div id="modalCarrinho" class="modal">
  <div class="modal-content">
    <h2>Carrinho</h2>
    <table id="tabelaCarrinho"></table>
    <p id="total" class="total"></p>
    <button onclick="finalizarCompra()" class="btnStart">Finalizar</button>
    <button onclick="fecharCarrinho()">Fechar</button>
  </div>
</div>

<!-- Cadastro -->
<div id="cadastroSuspenso">
  <h2>Cadastrar Produto</h2>
  <input id="codigoSuspenso" placeholder="C√≥digo">
  <input id="nomeSuspenso" placeholder="Nome">
  <select id="tipoSuspenso">
    <option>Unidade (UN)</option>
    <option>Peso (KG)</option>
  </select>
  <input id="valorSuspenso" type="number" step="0.01" placeholder="Valor">
  <button id="salvarSuspenso">Salvar</button>
</div>

<!-- Quantidade -->
<div id="quantidadeBox">
  <h2 id="qtdTitulo">Quantidade</h2>
  <input id="qtdInput" type="number">
  <button id="confirmarQtd" class="btnStart">Adicionar ao carrinho</button>
</div>

<script>
let produtos = JSON.parse(localStorage.getItem("produtos")||"[]");
let carrinho = JSON.parse(localStorage.getItem("carrinho")||"[]");
const badge=document.getElementById("badge");
const tabelaCarrinho=document.getElementById("tabelaCarrinho");
const total=document.getElementById("total");

const quantidadeBox=document.getElementById("quantidadeBox");
const qtdInput=document.getElementById("qtdInput");
let produtoAtual=null;

function abrirQuantidade(prod){
  produtoAtual=prod;
  quantidadeBox.style.display="block";
  if(prod.tipo.includes("KG")){
    qtdInput.step="0.001";qtdInput.min="0.001";qtdInput.placeholder="0.350";
  }else{
    qtdInput.step="1";qtdInput.min="1";qtdInput.placeholder="2";
  }
  qtdInput.value="";
}

document.getElementById("confirmarQtd").onclick=function(){
  const qtd=Number(qtdInput.value);
  if(qtd<=0) return alert("Quantidade inv√°lida");
  carrinho.push({...produtoAtual,qtd});
  localStorage.setItem("carrinho",JSON.stringify(carrinho));
  quantidadeBox.style.display="none";
  atualizarCarrinho();
  abrirCarrinho();
};

function atualizarCarrinho(){
  let soma=0;
  tabelaCarrinho.innerHTML="<tr><th>Produto</th><th>Qtd</th><th>Subtotal</th></tr>";
  carrinho.forEach(x=>{
    const sub=x.qtd*x.valor;soma+=sub;
    tabelaCarrinho.innerHTML+=`<tr><td>${x.nome}</td><td>${x.qtd}</td><td>R$ ${sub.toFixed(2)}</td></tr>`;
  });
  total.innerText="Total: R$ "+soma.toFixed(2);
  badge.innerText=carrinho.length;
}
atualizarCarrinho();

function abrirCarrinho(){modalCarrinho.style.display="block";}
function fecharCarrinho(){modalCarrinho.style.display="none";}
function finalizarCompra(){
  carrinho=[];
  localStorage.setItem("carrinho","[]");
  atualizarCarrinho();
  fecharCarrinho();
  alert("Compra finalizada!");
}
</script>

</body>
</html>
