<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>GoL BUY SMART</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#3b7ddd">

<script src="https://unpkg.com/@zxing/library@0.21.2"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
:root {
  --primary:#3b7ddd;
  --secondary:#ffb703;
  --background:#eef3ff;
  --card:#fff;
  --danger:#ff3b3b;
  --sidebar-width:220px;
  --transition-speed:0.3s;
  --font-base:16px;
  --radius:18px;
  --shadow:0 4px 18px rgba(0,0,0,.15);
}

/* Reset */
* {margin:0;padding:0;box-sizing:border-box;font-family:'Roboto',sans-serif;}
body {
  background: url('https://raw.githubusercontent.com/SEU_USUARIO/SEU_REPOSITORIO/main/fungo.png') no-repeat center top;
  background-size: cover;
  display:flex;
  min-height:100vh;
  overflow-x:hidden;
  font-size:var(--font-base);
}

/* Sidebar */
#sidebar{
  position:fixed; top:0; left:0; bottom:0;
  width:var(--sidebar-width); background:var(--primary);
  color:white; display:flex; flex-direction:column;
  padding-top:60px; transition:transform var(--transition-speed);
  z-index:100;
}
#sidebar.hide{transform:translateX(-100%);}
#sidebar button{
  background:none; border:none; color:white;
  text-align:left; padding:14px 20px; font-size:16px;
  display:flex; align-items:center; gap:8px; transition:background 0.2s; cursor:pointer;
  border-radius:8px;
}
#sidebar button:hover{background:rgba(255,255,255,0.2);}

/* Hamburger */
#hamburger{
  position:fixed; top:12px; left:12px;
  width:50px; height:50px; background:var(--primary);
  color:white; display:flex; align-items:center; justify-content:center;
  border-radius:12px; z-index:101; cursor:pointer; font-size:28px;
  box-shadow:var(--shadow);
}

/* Conte√∫do principal */
#content{
  margin-left:var(--sidebar-width);
  flex:1; padding:20px 10px;
  transition:margin-left var(--transition-speed);
}
#content.full{margin-left:0;}

/* Views */
.view{display:none; animation:fade .3s ease;}
.view.active{display:block;}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

/* Home */
#home{text-align:center; padding-top:20px;}
#home .logo-home{width:300px;height:300px;object-fit:contain;margin:0 auto 10px;}
#home h2{margin:10px 0;color:var(--primary); font-weight:700; font-size:1.5rem;}
#orcamento{position:relative; max-width:400px; margin:20px auto;}
#orcamento h3{margin-bottom:8px;}
#orcamento .input-container{position:relative;}
#orcamento .input-container input{
  width:100%; padding:12px; border-radius:12px; border:1px solid #ccc; font-size:16px;
  text-align:center;
}
#orcamento .input-container span{
  position:absolute; left:12px; top:50%; transform:translateY(-50%);
  font-weight:bold; color:#555;
}
#orcamentoBarra{
  height:22px; background:#ccc; border-radius:12px; margin-top:8px; overflow:hidden;
}
#orcamentoBarraInner{
  height:100%; width:0%; background:var(--secondary); text-align:center; color:white;
  font-weight:bold; line-height:22px; transition:width 0.5s ease;
  display:flex; align-items:center; justify-content:center;
}

/* Box */
.box{
  background:var(--card); border-radius:var(--radius); padding:20px; margin-bottom:20px;
  box-shadow:var(--shadow);
}

/* Scanner */
#scannerInfo{
  display:flex; flex-direction:column; gap:10px; margin-top:10px;
}
#camera{width:100%;height:250px;background:#000;border-radius:var(--radius);overflow:hidden;position:relative; box-shadow:var(--shadow);}
#camera video{width:100%;height:100%;object-fit:cover; border-radius:var(--radius);}
.scan-line{position:absolute;left:0;right:0;height:3px;background:var(--secondary);animation:scan 2s linear infinite;}
@keyframes scan{0%{top:10%}50%{top:90%}100%{top:10%}}
#scannerMsg{text-align:center;color:#333;font-weight:500;margin-top:6px;}
#barraValidacao{height:22px; background:#ccc; border-radius:12px; margin-top:10px; overflow:hidden;}
#barraValidacaoInner{
  height:100%; width:0%; background:var(--secondary); text-align:center; color:white;
  font-weight:bold; line-height:22px; display:flex; align-items:center; justify-content:center;
  transition:width 0.5s ease;
}

/* Produtos */
#produtosBox{overflow-x:auto;}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:16px;}
th,td{padding:10px;text-align:center;border:1px solid #ddd;}
tr:nth-child(even){background:#f3f3f3;}
button.editBtn{background:var(--secondary);color:#000;margin-right:5px;border:none;padding:6px 10px;border-radius:6px;cursor:pointer; transition:opacity .2s;}
button.editBtn:hover{opacity:0.8;}
button.deleteBtn{background:var(--danger);color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer; transition:opacity .2s;}
button.deleteBtn:hover{opacity:0.8;}

/* Hist√≥rico */
.historico-card{background:#fff;border-radius:12px;padding:15px;margin-bottom:12px;box-shadow:0 2px 12px rgba(0,0,0,.15);}
.historico-card h4{margin-bottom:6px; color:var(--primary);}
.historico-card details{margin-top:6px;}
.historico-card details ul{padding-left:20px;margin:0;max-height:150px;overflow-y:auto;}

/* Carrinho */
#carrinhoIcone{
  position:fixed; bottom:20px; right:20px;
  width:70px;height:70px; background:var(--primary);
  border-radius:50%; color:#fff; display:flex;
  align-items:center; justify-content:center; font-size:28px; cursor:pointer;
  z-index:200;
}
#carrinhoIcone span{
  position:absolute; top:-5px; right:-5px; width:22px;height:22px;
  background:red;color:#fff; border-radius:50%;
  font-size:12px; display:flex; align-items:center; justify-content:center;
}
#modalCarrinho{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;z-index:1000;}
#modalCarrinho .modal-content{
  background:#fff;width:95%;max-width:480px;margin:40px auto;padding:20px;border-radius:var(--radius);
  box-shadow:var(--shadow);
}
#modalCarrinho table{width:100%;margin-bottom:12px;border-collapse:collapse;}
#modalCarrinho table th, #modalCarrinho table td {border:1px solid #ddd; padding:8px; text-align:center;}
#modalCarrinho button{width:100%;padding:12px;margin-top:8px;border:none;border-radius:12px;color:white;font-weight:700; font-size:16px; cursor:pointer;}
#modalCarrinho button.finalizar{background:var(--primary);}
#modalCarrinho button.fechar{background:#555;}

/* Cadastro */
#cadastroBox{max-width:400px;margin:20px auto;}
#cadastroBox input, #cadastroBox select, #cadastroBox button{
  width:100%;padding:12px;margin-top:8px;border-radius:12px;border:1px solid #ccc;font-size:16px;
}
#cadastroBox button{background:var(--primary);color:white;border:none; font-weight:700; cursor:pointer; transition:opacity .2s;}
#cadastroBox button:hover{opacity:0.85;}

/* Gr√°fico scanner */
#scannerChartBox{margin-top:20px;}
</style>
</head>
<body>

<div id="hamburger">‚ò∞</div>

<div id="sidebar">
  <button onclick="irPara('home')">üè† Home</button>
  <button onclick="irPara('scanner')">üì∑ Scanner</button>
  <button onclick="irPara('produtos')">üì¶ Produtos</button>
  <button onclick="irPara('cadastro')">üìù Cadastro</button>
  <button onclick="irPara('historico')">üßæ Hist√≥rico</button>
</div>

<div id="content">

  <!-- Home -->
  <section id="home" class="view active">
    <img src="logo.png" class="logo-home" alt="Logo">
    <h2>Bem-vindo ao GoL BUY SMART</h2>

    <div id="orcamento" class="box">
      <h3>üí∞ Or√ßamento Mensal</h3>
      <div class="input-container">
        <span>R$</span>
        <input type="number" id="orcamentoInput" placeholder="Digite seu or√ßamento">
      </div>
      <div id="orcamentoBarra"><div id="orcamentoBarraInner">0%</div></div>
      <p style="margin-top:8px;">Gasto atual: R$ <span id="orcamentoGasto">0.00</span></p>
    </div>
  </section>

  <!-- Scanner -->
  <section id="scanner" class="view">
    <div class="box">
      <div id="camera"><video id="video" playsinline></video><div class="scan-line"></div></div>
      <p id="scannerMsg">üìå Posicione o c√≥digo de barras na √°rea da c√¢mera</p>
      <div id="scannerInfo">
        <p>C√≥digo detectado: <span id="detected">‚Äî</span></p>
        <p>Total produtos cadastrados: <span id="totalProdutos">0</span></p>
        <div id="scannerChartBox">
          <canvas id="categoriaChart"></canvas>
        </div>
      </div>
      <div id="barraValidacao"><div id="barraValidacaoInner">0%</div></div>
    </div>
  </section>

  <!-- Produtos -->
  <section id="produtos" class="view">
    <div id="produtosBox" class="box">
      <h2>Produtos Cadastrados</h2>
      <table id="produtosTable">
        <thead><tr><th>C√≥digo</th><th>Nome</th><th>Categoria</th><th>Tipo</th><th>Valor</th><th>A√ß√µes</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Cadastro -->
  <section id="cadastro" class="view">
    <div id="cadastroBox" class="box">
      <h2>Cadastro de Produto</h2>
      <input id="codigoCadastro" placeholder="C√≥digo">
      <input id="nomeCadastro" placeholder="Nome">
      <select id="categoriaCadastro">
        <option value="Alimentos">Alimentos</option>
        <option value="Limpeza">Limpeza</option>
        <option value="Higiene">Higiene</option>
        <option value="Outros">Outros</option>
      </select>
      <select id="tipoCadastro">
        <option>UN</option>
        <option>KG</option>
      </select>
      <input id="valorCadastro" type="number" step="0.01" placeholder="Valor">
      <button id="salvarCadastro">Salvar Produto</button>
    </div>
  </section>

  <!-- Hist√≥rico -->
  <section id="historico" class="view">
    <div class="box" id="historicoConteudo"></div>
  </section>

</div>

<div id="carrinhoIcone" onclick="abrirCarrinho()">üõçÔ∏è<span id="badge">0</span></div>
<div id="modalCarrinho" class="modal">
  <div class="modal-content">
    <h3>Carrinho</h3>
    <table id="tabelaCarrinho"></table>
    <p id="total">Total: R$ 0,00</p>
    <button class="finalizar" onclick="finalizarCompra()">Finalizar</button>
    <button class="fechar" onclick="fecharCarrinho()">Fechar</button>
  </div>
</div>

<script>
// ======== JS Completo do seu c√≥digo com anima√ß√£o suave ========

// Elements & Storage
const $=id=>document.getElementById(id);
const Storage={get:(k,f=[])=>JSON.parse(localStorage.getItem(k))||f,set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
let produtos=Storage.get("produtos"), carrinho=Storage.get("carrinho"), historico=Storage.get("historicoCompras"), orcamento=Storage.get("orcamento") || 0;
let reader=null,stream=null,buffer=[],scannerAtivo=false;
const repeticoes=3, beep=new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
let categoriaChart;

// Hamburger
const sidebar=$("sidebar"), content=$("content"), hamburger=$("hamburger");
hamburger.onclick=()=>{sidebar.classList.toggle("hide");content.classList.toggle("full");};

// Router
function irPara(tela){
  document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
  $(tela).classList.add("active");
  if(tela==="scanner") iniciarScanner(); else pararScanner();
}

// Home - Or√ßamento
$("orcamentoInput").value=orcamento;
$("orcamentoInput").addEventListener("input",()=>{
  orcamento=Number($("orcamentoInput").value);
  localStorage.setItem("orcamento", orcamento);
  atualizarOrcamento();
});

// Atualizar Or√ßamento
function atualizarOrcamento(){
  let gasto = carrinho.reduce((a,b)=>a+b.valor*b.qtd,0);
  $("orcamentoGasto").innerText=gasto.toFixed(2);
  let pct = orcamento ? Math.min(100, (gasto/orcamento*100)) : 0;
  $("orcamentoBarraInner").style.width=pct+"%";
  $("orcamentoBarraInner").innerText=Math.round(pct)+"%";
}

// Cadastro
function atualizarProdutosTable(){
  const tb=$("produtosTable").querySelector("tbody");
  tb.innerHTML="";
  produtos.forEach((p,i)=>{
    tb.innerHTML+=`<tr>
      <td>${p.codigo}</td>
      <td>${p.nome}</td>
      <td>${p.categoria}</td>
      <td>${p.tipo}</td>
      <td>R$ ${p.valor.toFixed(2)}</td>
      <td>
        <button class="editBtn" onclick="editarProduto(${i})">‚úèÔ∏è</button>
        <button class="deleteBtn" onclick="excluirProduto(${i})">‚ùå</button>
      </td>
    </tr>`;
  });
}
function editarProduto(i){
  irPara("cadastro");
  $("codigoCadastro").value=produtos[i].codigo;
  $("nomeCadastro").value=produtos[i].nome;
  $("categoriaCadastro").value=produtos[i].categoria;
  $("tipoCadastro").value=produtos[i].tipo;
  $("valorCadastro").value=produtos[i].valor;
  produtos.splice(i,1);
  Storage.set("produtos",produtos);
}
function excluirProduto(i){
  if(confirm("Excluir produto?")){
    produtos.splice(i,1);
    Storage.set("produtos",produtos);
    atualizarProdutosTable();
    atualizarScannerChart();
  }
}
$("salvarCadastro").onclick=()=>{
  let novo={
    codigo:$("codigoCadastro").value,
    nome:$("nomeCadastro").value,
    categoria:$("categoriaCadastro").value,
    tipo:$("tipoCadastro").value,
    valor:Number($("valorCadastro").value)
  };
  if(!novo.codigo||!novo.nome||!novo.valor) return alert("Preencha todos os campos");
  produtos.push(novo);
  Storage.set("produtos",produtos);
  atualizarProdutosTable();
  atualizarScannerChart();
  irPara("produtos");
};

// Carrinho
function atualizarCarrinho(){
  let total=0; $("tabelaCarrinho").innerHTML="<tr><th>Nome</th><th>Qtd</th><th>Subtotal</th></tr>";
  carrinho.forEach(p=>{let sub=p.valor*p.qtd; total+=sub; $("tabelaCarrinho").innerHTML+=`<tr><td>${p.nome}</td><td>${p.qtd}</td><td>R$ ${sub.toFixed(2)}</td></tr>`;});
  $("total").innerText="Total: R$ "+total.toFixed(2);
  $("badge").innerText=carrinho.length;
  atualizarOrcamento();
}
function abrirCarrinho(){ $("modalCarrinho").style.display="block"; atualizarCarrinho(); }
function fecharCarrinho(){ $("modalCarrinho").style.display="none"; }
function finalizarCompra(){
  if(!carrinho.length) return alert("Carrinho vazio");
  historico.push({data:new Date().toLocaleString("pt-BR"),itens:[...carrinho]});
  Storage.set("historicoCompras",historico);
  carrinho=[]; Storage.set("carrinho",carrinho);
  atualizarCarrinho();
  alert("Compra finalizada!");
}

// Scanner
function iniciarScanner(){
  if(scannerAtivo) return;
  scannerAtivo=true;
  navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
    .then(s=>{stream=s;$("video").srcObject=s;$("video").play(); reader=new ZXing.BrowserMultiFormatReader(); scanLoop();})
    .catch(e=>console.error(e));
}
function scanLoop(){
  if(!scannerAtivo) return;
  reader.decodeOnceFromVideoElement($("video")).then(result=>{
    $("detected").innerText=result.text;
    beep.play();
    let p=produtos.find(p=>p.codigo===result.text);
    if(p){
      let c=carrinho.find(c=>c.codigo===p.codigo);
      if(c) c.qtd++; else carrinho.push({...p,qtd:1});
      Storage.set("carrinho",carrinho);
      atualizarCarrinho();
    }
    $("barraValidacaoInner").style.width="100%";
    setTimeout(()=>{$("barraValidacaoInner").style.width="0%"; scanLoop();},500);
  }).catch(scanLoop);
}
function pararScanner(){scannerAtivo=false; if(stream){stream.getTracks().forEach(t=>t.stop());$("video").srcObject=null;}}

// Scanner Chart
function atualizarScannerChart(){
  const ctx=$("categoriaChart");
  const catCount={};
  produtos.forEach(p=>catCount[p.categoria]=(catCount[p.categoria]||0)+1);
  if(categoriaChart) categoriaChart.destroy();
  categoriaChart=new Chart(ctx,{type:'pie',data:{labels:Object.keys(catCount),datasets:[{data:Object.values(catCount),backgroundColor:['#3b7ddd','#ffb703','#ff6b6b','#6bffb7']}]},options:{responsive:true}});
}
atualizarProdutosTable(); atualizarScannerChart(); atualizarCarrinho();

</script>
</body>
</html>
