<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>GoL BUY SMART</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#3b7ddd">
<script src="https://unpkg.com/@zxing/library@0.21.2"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #3b7ddd;
  --secondary: #ffb703;
  --background: #eef3ff;
  --card: #fff;
  --danger: #ff3b3b;
  --sidebar-width: 220px;
  --transition-speed: 0.3s;
  --font-base: 16px;
  --radius: 16px;
  --shadow: 0 6px 18px rgba(0,0,0,.15);
}

/* Reset */
* {margin:0;padding:0;box-sizing:border-box;font-family:'Roboto',sans-serif;}
body {background:var(--background); display:flex; min-height:100vh; overflow-x:hidden; font-size:var(--font-base);}

/* Sidebar */
#sidebar{
  position:fixed; top:0; left:0; bottom:0;
  width:var(--sidebar-width); background:var(--primary);
  color:white; display:flex; flex-direction:column;
  padding-top:20px; transition:transform var(--transition-speed);
  z-index:100;
}
#sidebar.hide{transform:translateX(-100%);}
#sidebar button{
  background:none; border:none; color:white;
  text-align:left; padding:14px 20px; font-size:16px;
  display:flex; align-items:center; gap:8px; transition:background 0.2s; cursor:pointer;
  border-radius:8px;
}
#sidebar button:hover{background:rgba(255,255,255,0.2);}

/* Hamburger */
#hamburger{
  position:fixed; top:12px; left:12px;
  width:42px; height:42px; background:var(--primary);
  color:white; display:flex; align-items:center; justify-content:center;
  border-radius:10px; z-index:101; cursor:pointer; font-size:24px;
  box-shadow:var(--shadow);
}

/* Content */
#content{
  margin-left:var(--sidebar-width);
  flex:1; padding:20px;
  transition:margin-left var(--transition-speed);
}
#content.full{margin-left:0;}

/* Splash */
#splash{
  position:fixed; inset:0; background:#1a1a1a;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  color:white; z-index:2000;
}
#splash img{width:220px; height:220px; object-fit:contain; margin-bottom:12px; border-radius:50%;}
#splash p{font-size:18px; text-align:center; font-weight:500;}

/* Views */
.view{display:none; animation:fade .25s ease;}
.view.active{display:block;}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

/* Home */
#home{text-align:center;}
#home .logo-home{width:180px;height:180px;object-fit:contain;margin:20px auto;}
#home h2{margin:8px 0 16px; color:var(--primary); font-weight:500; font-size:1.3rem;}
#orcamento{position:relative; max-width:320px; margin:10px auto;}
#orcamento input{
  width:100%; padding:12px 12px 12px 40px; border-radius:12px; border:1px solid #ccc;
  font-size:16px;
}
#orcamento::before{
  content:'R$'; position:absolute; left:12px; top:12px; color:#555; font-weight:bold;
}
#homeCards{display:flex; flex-direction:column; gap:12px; margin-top:15px;}

/* Box */
.box{
  background:var(--card); border-radius:var(--radius); padding:20px; margin-bottom:20px;
  box-shadow:var(--shadow);
}

/* Scanner */
#scanner .box{display:flex; flex-direction:column; align-items:center;}
#camera{width:100%;max-width:480px;height:280px;background:#000;border-radius:var(--radius);overflow:hidden;position:relative;margin-top:10px; box-shadow:var(--shadow);}
#camera video{width:100%;height:100%;object-fit:cover; border-radius:var(--radius);}
.scan-line{position:absolute;left:0;right:0;height:3px;background:var(--secondary);animation:scan 2s linear infinite;}
@keyframes scan{0%{top:10%}50%{top:90%}100%{top:10%}}
#barraValidacao{height:22px;background:#ccc;border-radius:12px;margin-top:8px;width:100%;max-width:480px;}
#barraValidacaoInner{height:100%;width:0;background:var(--primary);border-radius:12px;text-align:center;color:white;font-weight:bold;transition:width 0.3s;}
#scannerStats{margin-top:12px;font-size:14px;text-align:left; width:100%; max-width:480px;}

/* Produtos */
#produtosContainer{background:var(--card); border-radius:var(--radius); padding:15px; max-height:400px; overflow-y:auto; box-shadow:var(--shadow);}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px;}
td,th{padding:8px;text-align:center;}
tr:nth-child(even){background:#f3f3f3;}
button.editBtn{background:var(--secondary);color:#000;margin-right:5px;border:none;padding:4px 8px;border-radius:6px;cursor:pointer;}
button.deleteBtn{background:var(--danger);color:white;border:none;padding:4px 8px;border-radius:6px;cursor:pointer;}

/* Hist√≥rico */
.historico-card{background:#fff;border-radius:12px;padding:15px;margin-bottom:12px;box-shadow:0 2px 12px rgba(0,0,0,.15);}
.historico-card h4{margin-bottom:6px; color:var(--primary);}
.historico-card details{margin-top:6px;}
.historico-card details ul{padding-left:20px;margin:0;max-height:150px;overflow-y:auto;}

/* Carrinho */
#carrinhoIcone{
  position:fixed; bottom:20px; right:20px;
  width:60px;height:60px; background:var(--primary);
  border-radius:15px; color:#fff; display:flex;
  align-items:center; justify-content:center; font-size:24px; cursor:pointer;
  z-index:200; box-shadow:var(--shadow);
}
#carrinhoIcone span{
  position:absolute; top:-5px; right:-5px; width:20px;height:20px;
  background:red;color:#fff; border-radius:50%;
  font-size:12px; display:flex; align-items:center; justify-content:center;
}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;z-index:1000;}
.modal-content{background:#fff;width:90%;max-width:480px;margin:40px auto;padding:20px;border-radius:var(--radius);box-shadow:var(--shadow);}

/* Cadastro produto */
#cadastroSuspenso, #cadastroManual .box input, #cadastroManual .box select, #cadastroManual .box button{
  width:100%;padding:12px;margin-top:8px;border-radius:12px;border:1px solid #ccc;
}
#cadastroSuspenso button, #cadastroManual .box button{background:var(--primary);color:white;border:none; cursor:pointer;}
#cadastroManual .box{max-width:400px;margin:20px auto;}
</style>
</head>
<body>

<div id="hamburger">‚ò∞</div>

<div id="sidebar">
  <button onclick="irPara('home')">üè† Home</button>
  <button onclick="irPara('scanner')">üì∑ Scanner</button>
  <button onclick="irPara('produtos')">üì¶ Produtos</button>
  <button onclick="irPara('historico')">üßæ Hist√≥rico</button>
  <button onclick="irPara('cadastroManual')">‚úèÔ∏è Cadastro Manual</button>
</div>

<div id="content">

  <div id="splash">
    <img src="logo.png" alt="Logo">
    <p>Bem-vindo ao seu app de compras inteligente</p>
  </div>

  <section id="home" class="view active">
    <img src="logo.png" class="logo-home" alt="Logo">
    <h2>Bem-vindo ao GoL BUY SMART</h2>
    <div class="box" id="orcamento">
      <h3>üí∞ Or√ßamento mensal</h3>
      <input type="number" id="orcamentoInput" placeholder="Digite seu or√ßamento">
    </div>
    <div class="box" id="homeCards"></div>
  </section>

  <section id="scanner" class="view">
    <div class="box">
      <div id="camera">
        <video id="video" playsinline></video>
        <div class="scan-line"></div>
      </div>
      <p><strong>C√≥digo detectado:</strong> <span id="detected">‚Äî</span></p>
      <div id="barraValidacao"><div id="barraValidacaoInner">0%</div></div>
      <div id="scannerStats">
        <p>Total produtos cadastrados: <span id="totalProdutos">0</span></p>
        <p>Produtos por categoria:</p>
        <ul id="categoriaStats"></ul>
      </div>
    </div>
  </section>

  <section id="produtos" class="view">
    <h2>Produtos cadastrados</h2>
    <div id="produtosContainer">
      <table id="produtosTable">
        <thead><tr><th>C√≥digo</th><th>Nome</th><th>Categoria</th><th>Tipo</th><th>Valor</th><th>A√ß√µes</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="cadastroManual" class="view">
    <div class="box">
      <h2>Cadastro de Produto Manual</h2>
      <input id="codigoManual" placeholder="C√≥digo">
      <input id="nomeManual" placeholder="Nome">
      <select id="categoriaManual">
        <option>Comida</option>
        <option>Limpeza</option>
        <option>Bebidas</option>
        <option>Higiene</option>
        <option>Outros</option>
      </select>
      <select id="tipoManual">
        <option>UN</option>
        <option>KG</option>
      </select>
      <input id="valorManual" type="number" step="0.01" placeholder="Valor">
      <button id="salvarManual">Salvar Produto</button>
    </div>
  </section>

  <section id="historico" class="view">
    <div class="box" id="historicoConteudo"></div>
  </section>

</div>

<div id="carrinhoIcone" onclick="abrirCarrinho()">üõçÔ∏è<span id="badge">0</span></div>
<div id="modalCarrinho" class="modal">
  <div class="modal-content">
    <h3>Carrinho</h3>
    <table id="tabelaCarrinho"></table>
    <p id="total">Total: R$ 0,00</p>
    <button onclick="finalizarCompra()">Finalizar</button>
    <button onclick="fecharCarrinho()">Fechar</button>
  </div>
</div>

<div id="cadastroSuspenso">
  <h3>Cadastrar/Editar Produto</h3>
  <input id="codigoSuspenso" placeholder="C√≥digo">
  <input id="nomeSuspenso" placeholder="Nome">
  <select id="categoriaSuspenso">
    <option>Comida</option>
    <option>Limpeza</option>
    <option>Bebidas</option>
    <option>Higiene</option>
    <option>Outros</option>
  </select>
  <select id="tipoSuspenso"><option>UN</option><option>KG</option></select>
  <input id="valorSuspenso" type="number" step="0.01" placeholder="Valor">
  <button id="salvarSuspenso">Salvar</button>
</div>

<script>
// ===================== JS COMPLETO =====================

// Elementos e storage
const $=id=>document.getElementById(id);
const Storage={get:(k,f=[])=>JSON.parse(localStorage.getItem(k))||f,set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
let produtos=Storage.get("produtos"), carrinho=Storage.get("carrinho"), historico=Storage.get("historicoCompras");
let reader=null,stream=null,buffer=[],scannerAtivo=false,editIndex=null;
const repeticoes=3, beep=new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");

// Splash
window.onload=()=>{
  $("orcamentoInput").value = Storage.get("orcamentoValue", "");
  setTimeout(()=>{
    $("splash").style.display="none"; 
    irPara('home'); 
    atualizarProdutos(); 
    atualizarHistorico(); 
    atualizarCarrinho(); 
    atualizarScannerStats();
    iniciarScanner();
  },1500);
};

// Sidebar toggle
const sidebar=$("sidebar"), content=$("content"), hamburger=$("hamburger");
hamburger.onclick=()=>{sidebar.classList.toggle("hide");content.classList.toggle("full");};

// Router
function irPara(tela){document.querySelectorAll(".view").forEach(v=>v.classList.remove("active")); $(tela).classList.add("active");}

// Produtos
function atualizarProdutos(){
  const tb=$("produtosTable").querySelector("tbody"); tb.innerHTML="";
  produtos.forEach((p,i)=>{
    tb.innerHTML+=`<tr>
      <td>${p.codigo}</td><td>${p.nome}</td><td>${p.categoria}</td><td>${p.tipo}</td><td>R$ ${p.valor.toFixed(2)}</td>
      <td><button class="editBtn" onclick="editarProduto(${i})">‚úèÔ∏è</button>
      <button class="deleteBtn" onclick="excluirProduto(${i})">‚ùå</button></td>
    </tr>`;
  });
  const homeCards=$("homeCards"); homeCards.innerHTML="";
  historico.slice(-2).reverse().forEach(h=>{
    homeCards.innerHTML+=`<div class="box"><strong>${h.data}</strong><br>Total: R$ ${h.total.toFixed(2)}</div>`;
  });
}
function excluirProduto(i){if(confirm("Excluir produto?")){produtos.splice(i,1);Storage.set("produtos",produtos);atualizarProdutos();atualizarScannerStats();}}
function editarProduto(i){editIndex=i;$("cadastroSuspenso").style.display="block";$("codigoSuspenso").value=produtos[i].codigo;$("nomeSuspenso").value=produtos[i].nome;$("categoriaSuspenso").value=produtos[i].categoria;$("tipoSuspenso").value=produtos[i].tipo;$("valorSuspenso").value=produtos[i].valor;}

// Scanner
async function iniciarScanner(){
  if(scannerAtivo) return;
  scannerAtivo=true; buffer=[];
  stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
  $("video").srcObject=stream; await $("video").play();
  reader=new ZXing.BrowserMultiFormatReader();
  reader.decodeFromVideoElementContinuously($("video"),res=>{
    if(!res||!scannerAtivo) return;
    const codigo=res.text.trim(); buffer.push(codigo); if(buffer.length>repeticoes) buffer.shift();
    let ok=buffer.filter(v=>v===codigo).length;
    $("barraValidacaoInner").style.width=(ok/repeticoes*100)+"%";
    $("barraValidacaoInner").innerText=Math.round(ok/repeticoes*100)+"%";
    $("detected").innerText=codigo;
    if(ok>=repeticoes){beep.play();processarCodigo(codigo);}
  });
}
function processarCodigo(codigo){
  scannerAtivo=false;
  let p=produtos.find(x=>x.codigo===codigo);
  if(p){
    let q=Number(prompt(`Produto: ${p.nome}\nQuantidade:`));
    if(q>0){carrinho.push({...p,qtd:q});Storage.set("carrinho",carrinho);abrirCarrinho();}
  } else{
    irPara('cadastroManual');
    $("codigoManual").value=codigo;
  }
  setTimeout(()=>{scannerAtivo=true;buffer=[];$("barraValidacaoInner").style.width="0%";},500);
}
function pararScanner(){scannerAtivo=false;if(reader)reader.reset();if(stream)stream.getTracks().forEach(t=>t.stop());stream=null;$("video").srcObject=null;}

// Cadastro produto suspenso
$("salvarSuspenso").onclick=()=>{
  const novo={codigo:$("codigoSuspenso").value,nome:$("nomeSuspenso").value,categoria:$("categoriaSuspenso").value,tipo:$("tipoSuspenso").value,valor:Number($("valorSuspenso").value)};
  if(!novo.codigo||!novo.nome||!novo.valor) return alert("Preencha tudo");
  if(editIndex!==null){produtos[editIndex]=novo; editIndex=null;} else {produtos.push(novo);}
  Storage.set("produtos",produtos); atualizarProdutos(); atualizarScannerStats(); $("cadastroSuspenso").style.display="none";
};

// Cadastro produto manual
$("salvarManual").onclick=()=>{
  const novo={codigo:$("codigoManual").value,nome:$("nomeManual").value,categoria:$("categoriaManual").value,tipo:$("tipoManual").value,valor:Number($("valorManual").value)};
  if(!novo.codigo||!novo.nome||!novo.valor) return alert("Preencha tudo");
  produtos.push(novo); Storage.set("produtos",produtos); atualizarProdutos(); atualizarScannerStats(); alert("Produto cadastrado");$("codigoManual").value=""; $("nomeManual").value=""; $("valorManual").value="";
};

// Carrinho
function atualizarCarrinho(){
  let total=0; $("tabelaCarrinho").innerHTML="<tr><th>Nome</th><th>Qtd</th><th>Subtotal</th></tr>";
  carrinho.forEach(p=>{let sub=p.valor*p.qtd; total+=sub; $("tabelaCarrinho").innerHTML+=`<tr><td>${p.nome}</td><td>${p.qtd}</td><td>R$ ${sub.toFixed(2)}</td></tr>`;});
  $("total").innerText="Total: R$ "+total.toFixed(2); $("badge").innerText=carrinho.length;
}
function abrirCarrinho(){ $("modalCarrinho").style.display="block"; atualizarCarrinho(); }
function fecharCarrinho(){ $("modalCarrinho").style.display="none"; }
function finalizarCompra(){
  if(!carrinho.length) return alert("Carrinho vazio");
  historico.push({data:new Date().toLocaleString("pt-BR"),total:carrinho.reduce((a,b)=>a+b.valor*b.qtd,0),itens:[...carrinho]});
  Storage.set("historicoCompras",historico);
  carrinho=[]; Storage.set("carrinho",carrinho);
  atualizarCarrinho(); atualizarHistorico(); fecharCarrinho(); alert("Compra finalizada!");
}

// Hist√≥rico
function atualizarHistorico(){
  const area=$("historicoConteudo"); area.innerHTML="";
  if(!historico.length){area.innerHTML="<p>Nenhuma compra registrada.</p>"; return;}
  historico.forEach((c,i)=>{
    let itens=""; c.itens.forEach(it=>{itens+=`<li>${it.nome} ‚Äî ${it.qtd} x R$ ${it.valor.toFixed(2)} = R$ ${(it.qtd*it.valor).toFixed(2)}</li>`;});
    area.innerHTML+=`<div class="historico-card">
      <h4>Compra ${i+1}</h4>
      <small>${c.data}</small><br>
      <strong>Total:</strong> R$ ${c.total.toFixed(2)}
      <details><summary>Ver itens</summary><ul>${itens}</ul></details>
    </div>`;
  });
}

// Or√ßamento
$("orcamentoInput").onchange=()=>{Storage.set("orcamentoValue",$("orcamentoInput").value);};

// Scanner stats
function atualizarScannerStats(){
  $("totalProdutos").innerText=produtos.length;
  const catCount={};
  produtos.forEach(p=>{catCount[p.categoria]=(catCount[p.categoria]||0)+1;});
  const ul=$("categoriaStats"); ul.innerHTML="";
  for(let cat in catCount){ul.innerHTML+=`<li>${cat}: ${catCount[cat]}</li>`;}
}
</script>

</body>
</html>
