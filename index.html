<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>GoL BUY SMART</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#3b7ddd">

<script src="https://unpkg.com/@zxing/browser@0.1.4"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#3b7ddd;
  --secondary:#ffb703;
  --background:#eef3ff;
  --card:#fff;
  --danger:#ff3b3b;
  --sidebar:220px;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:Roboto}
body{background:var(--background);display:flex;min-height:100vh}

/* ===== SIDEBAR ===== */
#sidebar{
  width:var(--sidebar);
  background:var(--primary);
  color:#fff;
  position:fixed;
  top:0;left:0;bottom:0;
  padding-top:20px;
  transition:.3s;
}
#sidebar.hide{transform:translateX(-100%)}
#sidebar button{
  width:100%;
  background:none;
  border:none;
  color:#fff;
  padding:14px 20px;
  text-align:left;
  font-size:16px;
  cursor:pointer;
}
#sidebar button:hover{background:rgba(255,255,255,.15)}

/* ===== CONTENT ===== */
#content{
  margin-left:var(--sidebar);
  width:100%;
  padding:20px;
  transition:.3s;
}
#content.full{margin-left:0}

/* ===== HAMBURGER ===== */
#hamburger{
  width:42px;height:42px;
  background:var(--primary);
  color:#fff;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  margin-bottom:10px;
}

/* ===== BOX ===== */
.box{
  background:var(--card);
  border-radius:18px;
  padding:20px;
  box-shadow:0 4px 18px rgba(0,0,0,.15);
  margin-bottom:20px;
}

/* ===== HOME ===== */
#home{text-align:center}
#home img{width:200px;margin:20px auto}
#orcamento input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #ccc;
  margin-top:10px;
  font-size:16px;
}

/* ===== VIEWS ===== */
.view{display:none;animation:fade .25s ease}
.view.active{display:block}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1}}

/* ===== SCANNER ===== */
#camera{width:100%;height:260px;background:#000;border-radius:18px;overflow:hidden;position:relative}
#camera video{width:100%;height:100%;object-fit:cover}
.scan-line{position:absolute;left:0;right:0;height:2px;background:red;animation:scan 2s linear infinite}
@keyframes scan{0%{top:10%}50%{top:90%}100%{top:10%}}

#barraValidacao{height:22px;background:#ccc;border-radius:12px;margin-top:8px}
#barraValidacaoInner{height:100%;width:0;background:var(--primary);border-radius:12px;color:#fff;text-align:center}

/* ===== TABLE ===== */
table{width:100%;border-collapse:collapse;margin-top:10px}
td,th{padding:10px;text-align:center}
tr:nth-child(even){background:#f3f3f3}

/* ===== MODAL ===== */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;z-index:10}
.modal-content{background:#fff;width:90%;max-width:480px;margin:40px auto;padding:20px;border-radius:18px}

/* ===== CARRINHO ===== */
#carrinhoIcone{
  position:fixed;bottom:20px;right:20px;
  width:70px;height:70px;
  background:var(--primary);
  border-radius:50%;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  cursor:pointer;
}
#badge{
  position:absolute;top:-5px;right:-5px;
  background:red;color:#fff;
  width:20px;height:20px;
  border-radius:50%;
  font-size:12px;
  display:flex;align-items:center;justify-content:center;
}

/* ===== CADASTRO ===== */
#cadastroSuspenso{
  position:fixed;bottom:10px;left:50%;
  transform:translateX(-50%);
  background:#fff;
  width:90%;max-width:400px;
  padding:20px;border-radius:18px;
  display:none;z-index:20;
}
#cadastroSuspenso input,select,button{
  width:100%;padding:12px;margin-top:8px;border-radius:12px;border:1px solid #ccc
}
</style>
</head>

<body>

<div id="sidebar">
  <button onclick="irPara('home')">üè† Home</button>
  <button onclick="irPara('scanner')">üì∑ Scanner</button>
  <button onclick="irPara('produtos')">üì¶ Produtos</button>
  <button onclick="irPara('historico')">üßæ Hist√≥rico</button>
</div>

<div id="content">
  <div id="hamburger">‚ò∞</div>

  <!-- HOME -->
  <section id="home" class="view active">
    <img src="logo.png">
    <h2>Bem-vindo ao GoL BUY SMART</h2>
    <div class="box" id="orcamento">
      <h3>üí∞ Or√ßamento mensal</h3>
      <input type="number" id="orcamentoInput" placeholder="Digite seu or√ßamento">
    </div>
  </section>

  <!-- SCANNER -->
  <section id="scanner" class="view">
    <div class="box">
      <button onclick="iniciarScanner()">üì∏ Abrir c√¢mera</button>
      <button onclick="pararScanner()">‚èπÔ∏è Parar</button>
      <div id="camera">
        <video id="video" playsinline></video>
        <div class="scan-line"></div>
      </div>
      <div id="barraValidacao"><div id="barraValidacaoInner">0%</div></div>
    </div>
  </section>

  <!-- PRODUTOS -->
  <section id="produtos" class="view">
    <div class="box">
      <h2>Produtos cadastrados</h2>
      <table id="produtosTable">
        <thead><tr><th>C√≥digo</th><th>Nome</th><th>Tipo</th><th>Valor</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- HIST√ìRICO -->
  <section id="historico" class="view">
    <div class="box">
      <h2>Hist√≥rico</h2>
      <div id="historicoConteudo"></div>
    </div>
  </section>
</div>

<div id="carrinhoIcone" onclick="abrirCarrinho()">üõçÔ∏è<div id="badge">0</div></div>

<div id="modalCarrinho" class="modal">
  <div class="modal-content">
    <h3>Carrinho</h3>
    <table id="tabelaCarrinho"></table>
    <p id="total"></p>
    <button onclick="finalizarCompra()">Finalizar</button>
    <button onclick="fecharCarrinho()">Fechar</button>
  </div>
</div>

<div id="cadastroSuspenso">
  <h3>Cadastrar produto</h3>
  <input id="codigoSuspenso" placeholder="C√≥digo">
  <input id="nomeSuspenso" placeholder="Nome">
  <select id="tipoSuspenso"><option>UN</option><option>KG</option></select>
  <input id="valorSuspenso" type="number" step="0.01" placeholder="Valor">
  <button onclick="salvarProduto()">Salvar</button>
</div>

<script>
const $=id=>document.getElementById(id);
const Storage={get:(k,f=[])=>JSON.parse(localStorage.getItem(k))||f,set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};

let produtos=Storage.get("produtos");
let carrinho=Storage.get("carrinho");
let historico=Storage.get("historico");
let reader,stream,buffer=[],ativo=false;
const beep=new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");

$("hamburger").onclick=()=>{
  sidebar.classList.toggle("hide");
  content.classList.toggle("full");
};

function irPara(t){
  document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
  $(t).classList.add("active");
}

function atualizarProdutos(){
  const tb=$("produtosTable").querySelector("tbody");
  tb.innerHTML="";
  produtos.forEach((p,i)=>{
    tb.innerHTML+=`<tr><td>${p.codigo}</td><td>${p.nome}</td><td>${p.tipo}</td><td>R$ ${p.valor}</td><td><button onclick="produtos.splice(${i},1);Storage.set('produtos',produtos);atualizarProdutos()">‚ùå</button></td></tr>`;
  });
}

function iniciarScanner(){
  ativo=true;buffer=[];
  navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(s=>{
    stream=s;$("video").srcObject=s;$("video").play();
    reader=new ZXingBrowser.BrowserMultiFormatReader();
    reader.decodeFromVideoElementContinuously($("video"),res=>{
      if(!res||!ativo)return;
      buffer.push(res.text);
      if(buffer.length>3)buffer.shift();
      let ok=buffer.filter(v=>v===res.text).length;
      $("barraValidacaoInner").style.width=(ok/3*100)+"%";
      $("barraValidacaoInner").innerText=Math.round(ok/3*100)+"%";
      if(ok>=3){beep.play();processar(res.text);}
    });
  });
}

function processar(cod){
  ativo=false;
  let p=produtos.find(x=>x.codigo===cod);
  if(p){carrinho.push({...p,qtd:1});Storage.set("carrinho",carrinho);abrirCarrinho();}
  else{$("cadastroSuspenso").style.display="block";$("codigoSuspenso").value=cod;}
}

function pararScanner(){
  ativo=false;
  if(reader)reader.reset();
  if(stream)stream.getTracks().forEach(t=>t.stop());
}

function salvarProduto(){
  produtos.push({codigo:codigoSuspenso.value,nome:nomeSuspenso.value,tipo:tipoSuspenso.value,valor:Number(valorSuspenso.value)});
  Storage.set("produtos",produtos);
  $("cadastroSuspenso").style.display="none";
  atualizarProdutos();
}

function abrirCarrinho(){modalCarrinho.style.display="block";}
function fecharCarrinho(){modalCarrinho.style.display="none";}
function finalizarCompra(){
  historico.push({data:new Date().toLocaleString(),itens:[...carrinho]});
  Storage.set("historico",historico);
  carrinho=[];Storage.set("carrinho",[]);
  fecharCarrinho();
}

window.onload=()=>atualizarProdutos();
</script>

</body>
</html>
