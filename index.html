<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Compras do m√™s</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/@zxing/library@latest"></script>

<style>
body{
    background:#eef3ff;
    font-family: Arial;
    margin:0;
}
.container{
    max-width:900px;
    margin:auto;
    padding:12px;
}
.logo{
    text-align:center;
    margin-top:10px;
}
.logo img{
    width:160px;
    height:160px;
    object-fit:cover;
    border-radius:50%;
    border:5px solid #ffffff;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.box{
    background:white;
    border-radius:18px;
    padding:16px;
    margin-top:15px;
    box-shadow:0 0 15px #00000010;
}
button{
    width:100%;
    padding:14px;
    border:none;
    font-size:16px;
    border-radius:12px;
    margin-top:8px;
}
.btnStart{ background:#2e6bff; color:white; }
.btnStop{ background:#6b6b6b; color:white; }

#camera{
    width:100%;
    height:260px;
    background:black;
    border-radius:18px;
    margin-top:10px;
    overflow:hidden;
    position:relative;
}
#camera video{
    width:100%;
    height:100%;
    object-fit:cover;
}

input, select{
    width:100%;
    padding:12px;
    border-radius:12px;
    border:1px solid #ccc;
    box-sizing:border-box;
    margin-top:6px;
}
table{
    width:100%;
    border-collapse:collapse;
}
td,th{
    padding:10px;
}
tr:nth-child(even){
    background:#f5f5f5;
}

/* üõçÔ∏è √çCONE SACOLA ‚Äî MANTIDO */
#carrinhoIcone{
    position:fixed;
    right:18px;
    bottom:18px;
    width:70px;
    height:70px;
    border-radius:50%;
    background:#2e6bff;
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    box-shadow:0 8px 20px rgba(0,0,0,.35);
    cursor:pointer;
}

.modal{
    position:fixed;
    left:0;
    top:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,.6);
    display:none;
}
.modal-content{
    background:white;
    width:92%;
    margin:40px auto;
    padding:12px;
    border-radius:18px;
}

.total{
    text-align:right;
    font-weight:bold;
    padding-top:10px;
}

#areaProdutosConteudo{
    display:none;
}
.toggleBtn{
    background:#ffb703;
    color:#000;
}

/* üßæ SUBTOTAL DESTACADO */
.subtotal{
    background:#e6edff;
    color:#1a3cff;
    padding:4px 8px;
    border-radius:6px;
    font-weight:bold;
}

/* üóëÔ∏è BOT√ÉO LIXEIRA */
#tabelaCarrinho th:last-child,
#tabelaCarrinho td:last-child{
    width:45px;
    text-align:center;
}
.btn-trash{
    background:none;
    border:none;
    font-size:20px;
    cursor:pointer;
    color:#ff3b3b;
}
.btn-trash:hover{
    transform:scale(1.15);
}

/* üé¨ ANIMA√á√ÉO REMOVER ITEM */
.removendo{
    animation: removerLinha .35s forwards;
}
@keyframes removerLinha{
    to{
        opacity:0;
        transform:translateX(-40px);
    }
}
</style>
</head>

<body>

<div class="container">

<div class="logo">
<img src="logo.jpg">
</div>

<h1 style="text-align:center">üõí Compras do m√™s üõçÔ∏è</h1>

<!-- SCANNER -->
<div class="box">
<button class="btnStart" id="startButton">üì∏ Abrir c√¢mera</button>
<button class="btnStop" id="stopButton">‚èπÔ∏è Parar</button>

<div id="camera">
<video id="video" playsinline></video>
</div>

<p><strong>C√≥digo detectado:</strong> <span id="detected">‚Äî</span></p>
</div>

<!-- lista produtos -->
<div class="box">
<h2>üì¶ Produtos cadastrados</h2>
<button class="toggleBtn" onclick="toggleProdutos()">Mostrar / Ocultar</button>

<div id="areaProdutosConteudo">
<table id="produtosTable">
<thead>
<tr>
<th>C√≥digo</th>
<th>Nome</th>
<th>Tipo</th>
<th>Pre√ßo</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>

<!-- cadastro -->
<div class="box">
<h2>‚úèÔ∏è Edi√ß√£o de produto</h2>

<label>C√≥digo</label>
<input id="codigo">

<label>Nome</label>
<input id="nome">

<label>Tipo</label>
<select id="tipo">
<option>Unidade (UN)</option>
<option>Peso (KG)</option>
</select>

<label>Valor</label>
<input id="valor" type="number" step="0.01">

<button onclick="salvarProduto()">Salvar</button>
</div>

</div>

<div id="carrinhoIcone" onclick="abrirCarrinho()">üõçÔ∏è</div>

<div id="modalCarrinho" class="modal">
<div class="modal-content">
<h2>Carrinho</h2>

<table id="tabelaCarrinho">
<tr>
<th>C√≥digo</th>
<th>Nome</th>
<th>Qtd</th>
<th>Subtotal</th>
<th></th>
</tr>
</table>

<p id="total" class="total">Total: R$ 0,00</p>

<button onclick="fecharCarrinho()">Fechar</button>
</div>
</div>

<script>
let produtos = JSON.parse(localStorage.getItem("produtos")||"[]");
let carrinho = [];

/* minimizar lista */
function toggleProdutos(){
    let div = document.getElementById("areaProdutosConteudo");
    div.style.display = (div.style.display==="none"||div.style.display==="") ? "block" : "none";
}

/* tabela produtos */
function atualizarTabela(){
    const tb=document.querySelector("#produtosTable tbody");
    tb.innerHTML="";
    produtos.forEach(p=>{
        let tr=document.createElement("tr");
        tr.innerHTML=`<td>${p.codigo}</td><td>${p.nome}</td><td>${p.tipo}</td><td>${p.valor}</td>`;
        tb.appendChild(tr);
    });
}
atualizarTabela();

/* salvar produto */
function salvarProduto(){
    let p={
        codigo:codigo.value,
        nome:nome.value,
        tipo:tipo.value,
        valor:Number(valor.value)
    };
    produtos = produtos.filter(x=>x.codigo!==p.codigo);
    produtos.push(p);
    localStorage.setItem("produtos",JSON.stringify(produtos));
    atualizarTabela();
    alert("Produto salvo");
}

/* carrinho */
function abrirCarrinho(){
    modalCarrinho.style.display="block";
    atualizarCarrinho();
}
function fecharCarrinho(){
    modalCarrinho.style.display="none";
}

function removerItem(i){
    const row=document.getElementById("row"+i);
    row.classList.add("removendo");
    setTimeout(()=>{
        carrinho.splice(i,1);
        atualizarCarrinho();
    },300);
}

function atualizarCarrinho(){
    let tabela=document.getElementById("tabelaCarrinho");
    tabela.innerHTML=`
    <tr>
    <th>C√≥digo</th><th>Nome</th><th>Qtd</th><th>Subtotal</th><th></th>
    </tr>`;
    let total=0;

    carrinho.forEach((x,i)=>{
        let sub=x.valor*x.qtd;
        total+=sub;
        tabela.innerHTML+=`
        <tr id="row${i}">
        <td>${x.codigo}</td>
        <td>${x.nome}</td>
        <td>${x.qtd}</td>
        <td><span class="subtotal">R$ ${sub.toFixed(2)}</span></td>
        <td><button class="btn-trash" onclick="removerItem(${i})">üóëÔ∏è</button></td>
        </tr>`;
    });

    totalEl.innerText="Total: R$ "+total.toFixed(2);
}
const totalEl=document.getElementById("total");
</script>

</body>
</html>
