<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>GoL BUY SMART</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#3b7ddd">

<script src="https://unpkg.com/@zxing/browser@0.1.4"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#3b7ddd;
  --secondary:#ffb703;
  --bg:#eef3ff;
  --card:#fff;
  --danger:#ff3b3b;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:Roboto}
body{background:var(--bg);min-height:100vh}

/* SIDEBAR */
#hamburger{
  position:fixed;top:12px;left:12px;
  width:42px;height:42px;
  background:var(--primary);color:#fff;
  border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  z-index:1000;font-size:22px
}
#sidebar{
  position:fixed;top:0;left:0;bottom:0;
  width:220px;background:var(--primary);
  padding-top:70px;transform:translateX(-100%);
  transition:.3s;z-index:999
}
#sidebar.show{transform:none}
#sidebar button{
  width:100%;background:none;border:none;
  color:#fff;padding:14px 20px;
  text-align:left;font-size:16px
}

/* CONTENT */
#content{padding:20px;padding-top:70px}
.view{display:none}
.view.active{display:block}

/* CARD */
.card{
  background:var(--card);
  border-radius:18px;
  padding:18px;
  box-shadow:0 4px 18px rgba(0,0,0,.15);
  margin-bottom:18px
}

/* HOME */
.logo-home{width:260px;margin:10px auto;display:block}
.home-text{text-align:center;font-size:18px;margin-bottom:20px}

/* OR√áAMENTO */
.orcamento-box{
  display:flex;align-items:center;
  border:1px solid #ccc;
  border-radius:14px;
  padding:12px;font-size:18px
}
.orcamento-box span{margin-right:6px}
.orcamento-box input{
  border:none;font-size:18px;width:100%;
  outline:none
}
.progress{
  height:18px;background:#ddd;
  border-radius:10px;margin-top:10px
}
.progress div{
  height:100%;width:0;
  background:var(--primary);
  border-radius:10px;color:#fff;
  font-size:12px;text-align:center
}

/* SCANNER */
#camera{
  width:100%;height:260px;
  background:#000;border-radius:18px;
  overflow:hidden;position:relative
}
#camera video{width:100%;height:100%;object-fit:cover}
.scan-frame{
  position:absolute;inset:20px;
  border:2px solid rgba(0,255,0,.7);
  border-radius:16px
}

/* TABLE */
table{width:100%;border-collapse:collapse}
th,td{padding:10px;text-align:center}
tr:nth-child(even){background:#f3f3f3}

/* HIST */
.hist-card{
  background:#fff;border-radius:16px;
  padding:14px;margin-bottom:12px
}
.hist-card ul{padding-left:18px}

/* MODAL */
.modal{position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;z-index:2000
}
.modal-content{
  background:#fff;border-radius:18px;
  width:90%;max-width:400px;
  margin:40px auto;padding:20px
}
.modal-content input,select,button{
  width:100%;padding:12px;
  margin-top:8px;border-radius:12px;
  border:1px solid #ccc
}
</style>
</head>

<body>

<div id="hamburger">‚ò∞</div>

<div id="sidebar">
  <button onclick="irPara('home')">üè† Home</button>
  <button onclick="irPara('scanner')">üì∑ Scanner</button>
  <button onclick="irPara('produtos')">üì¶ Produtos</button>
  <button onclick="irPara('historico')">üßæ Hist√≥rico</button>
</div>

<div id="content">

<section id="home" class="view active">
  <img src="logo.png" class="logo-home">
  <div class="home-text">Bem-vindo ao seu app de compras inteligente</div>

  <div class="card">
    <h3>üí∞ Or√ßamento mensal</h3>
    <div class="orcamento-box">
      <span>R$</span>
      <input id="orcamentoInput" type="number" placeholder="0,00">
    </div>
    <div class="progress">
      <div id="orcamentoBar">0%</div>
    </div>
  </div>

  <div class="card">
    <h3>üïí √öltimas compras</h3>
    <div id="ultimasCompras"></div>
  </div>
</section>

<section id="scanner" class="view">
  <div class="card">
    <div id="camera">
      <video id="video" playsinline></video>
      <div class="scan-frame"></div>
    </div>
    <p>C√≥digo detectado: <strong id="codigoDetectado">‚Äî</strong></p>
  </div>
</section>

<section id="produtos" class="view">
  <div class="card">
    <h3>Produtos cadastrados</h3>
    <table>
      <thead>
        <tr><th>C√≥digo</th><th>Nome</th><th>Tipo</th><th>Valor</th><th></th></tr>
      </thead>
      <tbody id="produtosBody"></tbody>
    </table>
  </div>
</section>

<section id="historico" class="view">
  <div id="historicoLista"></div>
</section>

</div>

<div id="cadastro" class="modal">
  <div class="modal-content">
    <h3>Cadastrar produto</h3>
    <input id="cCodigo" placeholder="C√≥digo">
    <input id="cNome" placeholder="Nome">
    <select id="cTipo"><option>UN</option><option>KG</option></select>
    <input id="cValor" type="number" step="0.01" placeholder="Valor">
    <button onclick="salvarProduto()">Salvar</button>
  </div>
</div>

<script>
const $=id=>document.getElementById(id);
const store=(k,v)=>v?localStorage.setItem(k,JSON.stringify(v)):JSON.parse(localStorage.getItem(k))||[];

let produtos=store("produtos");
let historico=store("historico");
let carrinho=[];
let reader,stream,buffer=[],ativo=true;
const beep=new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");

$("hamburger").onclick=()=>$("sidebar").classList.toggle("show");

function irPara(v){
  document.querySelectorAll(".view").forEach(x=>x.classList.remove("active"));
  $(v).classList.add("active");
  $("sidebar").classList.remove("show");
}

function atualizarProdutos(){
  const b=$("produtosBody");b.innerHTML="";
  produtos.forEach((p,i)=>{
    b.innerHTML+=`
      <tr>
        <td>${p.codigo}</td>
        <td>${p.nome}</td>
        <td>${p.tipo}</td>
        <td>R$ ${p.valor.toFixed(2)}</td>
        <td><button onclick="produtos.splice(${i},1);store('produtos',produtos);atualizarProdutos()">‚ùå</button></td>
      </tr>`;
  });
}

function iniciarScanner(){
  navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(s=>{
    stream=s;$("video").srcObject=s;$("video").play();
    reader=new ZXingBrowser.BrowserMultiFormatReader();
    reader.decodeFromVideoElementContinuously($("video"),res=>{
      if(!res||!ativo)return;
      buffer.push(res.text);if(buffer.length>3)buffer.shift();
      $("codigoDetectado").innerText=res.text;
      if(buffer.filter(v=>v===res.text).length>=3){
        ativo=false;beep.play();processar(res.text);
      }
    });
  });
}

function processar(c){
  let p=produtos.find(x=>x.codigo===c);
  if(p){
    carrinho.push(p);
    historico.push({data:new Date().toLocaleString(),itens:[p],total:p.valor});
    store("historico",historico);
    atualizarHome();
  }else{
    $("cCodigo").value=c;
    $("cadastro").style.display="block";
  }
}

function salvarProduto(){
  produtos.push({
    codigo:cCodigo.value,
    nome:cNome.value,
    tipo:cTipo.value,
    valor:Number(cValor.value)
  });
  store("produtos",produtos);
  $("cadastro").style.display="none";
  atualizarProdutos();
}

function atualizarHome(){
  const u=$("ultimasCompras");u.innerHTML="";
  historico.slice(-2).reverse().forEach(h=>{
    u.innerHTML+=`<p>${h.data} ‚Äî <strong>R$ ${h.total.toFixed(2)}</strong></p>`;
  });
}

window.onload=()=>{
  atualizarProdutos();
  atualizarHome();
  iniciarScanner();
};
</script>

</body>
</html>
