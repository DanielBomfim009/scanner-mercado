<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#3b7ddd" />
  <title>GoL BUY SMART</title>

  <!-- Bibliotecas externas (sem espa√ßos!) -->
  <script src="https://unpkg.com/@zxing/library@0.21.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --primary: #3b7ddd;
      --secondary: #ffb703;
      --background: #eef3ff;
      --card: #fff;
      --danger: #ff3b3b;
      --sidebar-width: 220px;
      --transition-speed: 0.3s;
      --font-base: 16px;
      --radius: 18px;
      --shadow: 0 4px 18px rgba(0, 0, 0, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Roboto', sans-serif;
    }

    body {
      background-color: var(--background);
      /* Substitua pela URL correta ou remova */
      /* background-image: url('https://raw.githubusercontent.com/seu_usuario/seu_repositorio/main/fungo.png'); */
      background-size: cover;
      display: flex;
      min-height: 100vh;
      overflow-x: hidden;
      font-size: var(--font-base);
    }

    /* Splash Screen */
    #splash {
      position: fixed;
      inset: 0;
      background: #1a1a1a;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    #splash img {
      width: 300px;
      height: 300px;
      object-fit: contain;
    }
    #splash p {
      margin-top: 15px;
      font-size: 18px;
    }

    /* Sidebar */
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: var(--sidebar-width);
      background: var(--primary);
      color: white;
      display: flex;
      flex-direction: column;
      padding-top: 60px;
      transition: transform var(--transition-speed);
      z-index: 100;
    }
    #sidebar.hide {
      transform: translateX(-100%);
    }
    #sidebar button {
      background: none;
      border: none;
      color: white;
      text-align: left;
      padding: 14px 20px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      border-radius: 8px;
      width: 100%;
    }
    #sidebar button:hover, #sidebar button:focus {
      background: rgba(255, 255, 255, 0.2);
      outline: 2px solid white;
    }

    /* Hamburger - agora √© um bot√£o acess√≠vel */
    #hamburger {
      position: fixed;
      top: 12px;
      left: 12px;
      width: 50px;
      height: 50px;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      z-index: 101;
      cursor: pointer;
      font-size: 28px;
      box-shadow: var(--shadow);
      border: none;
    }

    /* Content */
    #content {
      margin-left: var(--sidebar-width);
      flex: 1;
      padding: 20px 10px;
      transition: margin-left var(--transition-speed);
    }
    #content.full {
      margin-left: 0;
    }

    /* Views */
    .view {
      display: none;
      animation: fade 0.3s ease;
    }
    .view.active {
      display: block;
    }
    @keyframes fade {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: none; }
    }

    /* Home */
    #home {
      text-align: center;
      padding-top: 20px;
    }
    .logo-home {
      width: 300px;
      height: 300px;
      object-fit: contain;
      margin: 0 auto 10px;
    }
    #home h2 {
      margin: 10px 0;
      color: var(--primary);
      font-weight: 700;
      font-size: 1.5rem;
    }

    .box {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }

    /* Or√ßamento */
    #orcamento {
      max-width: 400px;
      margin: 20px auto;
    }
    #orcamento label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }
    #orcamento input {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    #orcamentoBarra {
      height: 22px;
      background: #ccc;
      border-radius: 12px;
      margin-top: 8px;
      overflow: hidden;
    }
    #orcamentoBarraInner {
      height: 100%;
      width: 0%;
      background: var(--secondary);
      text-align: center;
      color: white;
      font-weight: bold;
      transition: width 0.5s;
    }

    /* Scanner */
    #camera {
      width: 100%;
      height: 250px;
      background: #000;
      border-radius: var(--radius);
      overflow: hidden;
      position: relative;
      box-shadow: var(--shadow);
    }
    #camera video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: var(--radius);
    }
    .scan-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--secondary);
      animation: scan 2s linear infinite;
    }
    @keyframes scan {
      0% { top: 10%; }
      50% { top: 90%; }
      100% { top: 10%; }
    }

    /* Produtos */
    #produtosBox {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 16px;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    tr:nth-child(even) {
      background: #f3f3f3;
    }
    .editBtn, .deleteBtn {
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      margin: 2px;
    }
    .editBtn {
      background: var(--secondary);
      color: #000;
    }
    .deleteBtn {
      background: var(--danger);
      color: white;
    }

    /* Hist√≥rico */
    .historico-card {
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 12px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
    }
    .historico-card h4 {
      margin-bottom: 6px;
      color: var(--primary);
    }
    .historico-card details {
      margin-top: 6px;
    }
    .historico-card details ul {
      padding-left: 20px;
      margin: 0;
      max-height: 150px;
      overflow-y: auto;
    }

    /* Carrinho */
    #carrinhoIcone {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 70px;
      height: 70px;
      background: var(--primary);
      border-radius: 50%;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      cursor: pointer;
      z-index: 200;
      border: none;
    }
    #carrinhoIcone span {
      position: absolute;
      top: -5px;
      right: -5px;
      width: 22px;
      height: 22px;
      background: red;
      color: #fff;
      border-radius: 50%;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #modalCarrinho {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      z-index: 1000;
    }
    #modalCarrinho .modal-content {
      background: #fff;
      width: 95%;
      max-width: 480px;
      margin: 40px auto;
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    #modalCarrinho table {
      width: 100%;
      margin-bottom: 12px;
    }
    #modalCarrinho button {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border: none;
      border-radius: 12px;
      color: white;
      background: var(--primary);
      cursor: pointer;
      font-weight: 700;
    }

    /* Cadastro */
    #cadastroBox {
      max-width: 400px;
      margin: 20px auto;
    }
    #cadastroBox label {
      display: block;
      margin-top: 12px;
      font-weight: 500;
    }
    #cadastroBox input,
    #cadastroBox select,
    #cadastroBox button {
      width: 100%;
      padding: 12px;
      margin-top: 4px;
      border-radius: 12px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    #cadastroBox button {
      background: var(--primary);
      color: white;
      border: none;
      font-weight: 700;
      margin-top: 16px;
    }

    /* Gr√°fico */
    #scannerChartBox {
      margin-top: 20px;
    }
    #barraValidacao {
      height: 22px;
      background: #ccc;
      border-radius: 12px;
      margin-top: 8px;
      overflow: hidden;
    }
    #barraValidacaoInner {
      height: 100%;
      width: 0%;
      background: var(--secondary);
      text-align: center;
      color: white;
      font-weight: bold;
      transition: width 0.5s;
    }

    /* Reduz anima√ß√µes se solicitado */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>

<body>
  <!-- Splash Screen -->
  <div id="splash" role="alert" aria-live="polite">
    <img src="logo.png" alt="GoL BUY SMART ‚Äì App de compras inteligente" />
    <p>Bem-vindo ao seu app de compras inteligente</p>
  </div>

  <!-- Menu Hamburger (agora √© um bot√£o!) -->
  <button id="hamburger" aria-label="Abrir menu">‚ò∞</button>

  <!-- Sidebar -->
  <nav id="sidebar" aria-label="Navega√ß√£o principal">
    <button onclick="irPara('home')">üè† Home</button>
    <button onclick="irPara('scanner')">üì∑ Scanner</button>
    <button onclick="irPara('produtos')">üì¶ Produtos</button>
    <button onclick="irPara('cadastro')">üìù Cadastro</button>
    <button onclick="irPara('historico')">üßæ Hist√≥rico</button>
  </nav>

  <!-- Conte√∫do Principal -->
  <main id="content" role="main">
    <!-- Home -->
    <section id="home" class="view active" aria-labelledby="home-title">
      <img src="logo.png" class="logo-home" alt="GoL BUY SMART ‚Äì App de compras inteligente" />
      <h2 id="home-title">Bem-vindo ao GoL BUY SMART</h2>

      <div id="orcamento" class="box">
        <label for="orcamentoInput">üí∞ Or√ßamento Mensal (R$)</label>
        <input type="number" id="orcamentoInput" placeholder="Ex: 500" min="0" step="0.01" />
        <div id="orcamentoBarra" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
          <div id="orcamentoBarraInner">0%</div>
        </div>
        <p style="margin-top: 8px;">Gasto atual: R$ <span id="orcamentoGasto">0.00</span></p>
      </div>
    </section>

    <!-- Scanner -->
    <section id="scanner" class="view" aria-labelledby="scanner-title">
      <div class="box">
        <h2 id="scanner-title">Scanner de Produtos</h2>
        <div id="camera">
          <video id="video" playsinline></video>
          <div class="scan-line"></div>
        </div>
        <div id="scannerInfo">
          <p>C√≥digo detectado: <span id="detected" aria-live="polite">‚Äî</span></p>
          <p>Total produtos cadastrados: <span id="totalProdutos">0</span></p>
          <div id="scannerChartBox">
            <canvas id="categoriaChart" aria-label="Gr√°fico de distribui√ß√£o por categoria"></canvas>
          </div>
        </div>
        <div id="barraValidacao" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
          <div id="barraValidacaoInner">0%</div>
        </div>
      </div>
    </section>

    <!-- Produtos -->
    <section id="produtos" class="view" aria-labelledby="produtos-title">
      <div id="produtosBox" class="box">
        <h2 id="produtos-title">Produtos Cadastrados</h2>
        <table id="produtosTable">
          <thead>
            <tr>
              <th>C√≥digo</th>
              <th>Nome</th>
              <th>Categoria</th>
              <th>Tipo</th>
              <th>Valor</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Cadastro -->
    <section id="cadastro" class="view" aria-labelledby="cadastro-title">
      <div id="cadastroBox" class="box">
        <h2 id="cadastro-title">Cadastro de Produto</h2>
        <label for="codigoCadastro">C√≥digo</label>
        <input id="codigoCadastro" placeholder="Ex: 123456" />

        <label for="nomeCadastro">Nome</label>
        <input id="nomeCadastro" placeholder="Ex: Arroz 1kg" />

        <label for="categoriaCadastro">Categoria</label>
        <select id="categoriaCadastro">
          <option value="Alimentos">Alimentos</option>
          <option value="Limpeza">Limpeza</option>
          <option value="Bebida">Bebida</option>
          <option value="Farm√°cia">Farm√°cia</option>
          <option value="Higiene">Higiene</option>
          <option value="Outros">Outros</option>
        </select>

        <label for="tipoCadastro">Tipo</label>
        <select id="tipoCadastro">
          <option>UN</option>
          <option>KG</option>
        </select>

        <label for="valorCadastro">Valor (R$)</label>
        <input id="valorCadastro" type="number" step="0.01" placeholder="Ex: 12.99" min="0" />

        <button id="salvarCadastro">Salvar Produto</button>
      </div>
    </section>

    <!-- Hist√≥rico -->
    <section id="historico" class="view" aria-labelledby="historico-title">
      <div class="box">
        <h2 id="historico-title">Hist√≥rico de Compras</h2>
        <div id="historicoConteudo"></div>
      </div>
    </section>
  </main>

  <!-- Carrinho -->
  <button id="carrinhoIcone" aria-label="Abrir carrinho">
    üõçÔ∏è<span id="badge" aria-label="Itens no carrinho">0</span>
  </button>

  <div id="modalCarrinho" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal-content">
      <h3 id="modal-title">Carrinho</h3>
      <table id="tabelaCarrinho">
        <thead>
          <tr><th>Nome</th><th>Qtd</th><th>Subtotal</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <p id="total">Total: R$ 0,00</p>
      <button onclick="finalizarCompra()">Finalizar Compra</button>
      <button onclick="fecharCarrinho()">Fechar</button>
    </div>
  </div>

  <script>
    // =============== UTILIT√ÅRIOS ===============
    const $ = id => document.getElementById(id);
    const Storage = {
      get: (k, f = []) => JSON.parse(localStorage.getItem(k)) || f,
      set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
    };

    // =============== DADOS ===============
    let produtos = Storage.get("produtos");
    let carrinho = Storage.get("carrinho");
    let historico = Storage.get("historicoCompras");
    let orcamento = parseFloat(Storage.get("orcamento")) || 0;
    let reader = null, stream = null, buffer = [], scannerAtivo = false;
    const repeticoes = 3;
    const beep = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
    let categoriaChart;

    // =============== SPLASH ===============
    window.addEventListener('load', () => {
      setTimeout(() => {
        $("splash").style.display = "none";
      }, 1500);
    });

    // =============== SIDEBAR ===============
    const sidebar = $("sidebar");
    const content = $("content");
    const hamburger = $("hamburger");
    hamburger.addEventListener('click', () => {
      sidebar.classList.toggle("hide");
      content.classList.toggle("full");
    });

    // =============== ROTEAMENTO ===============
    function irPara(tela) {
      document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
      $(tela).classList.add("active");
      if (tela === "scanner") iniciarScanner();
      else pararScanner();
    }

    // =============== OR√áAMENTO ===============
    $("orcamentoInput").value = orcamento || '';
    $("orcamentoInput").addEventListener("input", () => {
      orcamento = parseFloat($("orcamentoInput").value) || 0;
      Storage.set("orcamento", orcamento);
      atualizarOrcamento();
    });

    function atualizarOrcamento() {
      const gasto = carrinho.reduce((a, b) => a + (b.valor * (b.qtd || 1)), 0);
      $("orcamentoGasto").textContent = gasto.toFixed(2);
      const pct = orcamento ? Math.min(100, (gasto / orcamento) * 100) : 0;
      const bar = $("orcamentoBarraInner");
      bar.style.width = pct + "%";
      bar.textContent = Math.round(pct) + "%";
      $("orcamentoBarra").setAttribute("aria-valuenow", Math.round(pct));
    }

    // =============== PRODUTOS ===============
    function atualizarProdutosTable() {
      const tbody = $("produtosTable").querySelector("tbody");
      tbody.innerHTML = "";
      produtos.forEach((p, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${escapeHtml(p.codigo)}</td>
          <td>${escapeHtml(p.nome)}</td>
          <td>${escapeHtml(p.categoria)}</td>
          <td>${escapeHtml(p.tipo)}</td>
          <td>R$ ${p.valor.toFixed(2)}</td>
          <td>
            <button class="editBtn" onclick="editarProduto(${i})" aria-label="Editar ${p.nome}">‚úèÔ∏è</button>
            <button class="deleteBtn" onclick="excluirProduto(${i})" aria-label="Excluir ${p.nome}">‚ùå</button>
          </td>`;
        tbody.appendChild(row);
      });
      $("totalProdutos").textContent = produtos.length;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function editarProduto(i) {
      irPara("cadastro");
      const p = produtos[i];
      $("codigoCadastro").value = p.codigo;
      $("nomeCadastro").value = p.nome;
      $("categoriaCadastro").value = p.categoria;
      $("tipoCadastro").value = p.tipo;
      $("valorCadastro").value = p.valor;
      produtos.splice(i, 1);
      Storage.set("produtos", produtos);
    }

    function excluirProduto(i) {
      if (confirm("Excluir produto?")) {
        produtos.splice(i, 1);
        Storage.set("produtos", produtos);
        atualizarProdutosTable();
        atualizarScannerChart();
      }
    }

    $("salvarCadastro").addEventListener('click', () => {
      const novo = {
        codigo: $("codigoCadastro").value.trim(),
        nome: $("nomeCadastro").value.trim(),
        categoria: $("categoriaCadastro").value,
        tipo: $("tipoCadastro").value,
        valor: parseFloat($("valorCadastro").value)
      };
      if (!novo.codigo || !novo.nome || !novo.valor || isNaN(novo.valor)) {
        alert("Preencha todos os campos corretamente.");
        return;
      }
      produtos.push(novo);
      Storage.set("produtos", produtos);
      atualizarProdutosTable();
      atualizarScannerChart();
      irPara("produtos");
    });

    // =============== CARRINHO ===============
    function atualizarCarrinho() {
      const tbody = $("tabelaCarrinho").querySelector("tbody");
      tbody.innerHTML = "";
      let total = 0;
      carrinho.forEach(p => {
        const qtd = p.qtd || 1;
        const sub = p.valor * qtd;
        total += sub;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${escapeHtml(p.nome)}</td>
          <td>${qtd}</td>
          <td>R$ ${sub.toFixed(2)}</td>`;
        tbody.appendChild(row);
      });
      $("total").textContent = "Total: R$ " + total.toFixed(2);
      $("badge").textContent = carrinho.length;
      atualizarOrcamento();
    }

    function abrirCarrinho() {
      $("modalCarrinho").style.display = "block";
      atualizarCarrinho();
    }

    function fecharCarrinho() {
      $("modalCarrinho").style.display = "none";
    }

    function finalizarCompra() {
      if (!carrinho.length) {
        alert("Carrinho vazio");
        return;
      }
      const total = carrinho.reduce((a, b) => a + b.valor * (b.qtd || 1), 0);
      historico.push({
         new Date().toLocaleString("pt-BR"),
        total,
        itens: [...carrinho]
      });
      Storage.set("historicoCompras", historico);
      carrinho = [];
      Storage.set("carrinho", carrinho);
      atualizarCarrinho();
      atualizarHistorico();
      fecharCarrinho();
      alert("Compra finalizada!");
    }

    // =============== HIST√ìRICO ===============
    function atualizarHistorico() {
      const area = $("historicoConteudo");
      area.innerHTML = "";
      if (!historico.length) {
        area.innerHTML = "<p>Nenhuma compra registrada.</p>";
        return;
      }
      historico.forEach((compra, idx) => {
        const card = document.createElement('div');
        card.className = 'historico-card';
        card.innerHTML = `
          <h4>Compra ${idx + 1}</h4>
          <small>${escapeHtml(compra.data)}</small>
          <p>Total: R$ ${compra.total.toFixed(2)}</p>
          <details><summary>Ver itens</summary><ul id="itens-${idx}"></ul></details>`;
        area.appendChild(card);

        const ul = card.querySelector(`#itens-${idx}`);
        compra.itens.forEach(it => {
          const li = document.createElement('li');
          li.textContent = `${it.nome} ‚Äî ${it.qtd || 1} x R$ ${it.valor.toFixed(2)} = R$ ${(it.qtd * it.valor).toFixed(2)}`;
          ul.appendChild(li);
        });
      });
    }

    // =============== SCANNER ===============
    async function iniciarScanner() {
      if (scannerAtivo) return;
      scannerAtivo = true;
      buffer = [];
      if (!stream) {
        try {
          stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
          $("video").srcObject = stream;
          await $("video").play();
        } catch (err) {
          alert("Permiss√£o da c√¢mera negada. O scanner n√£o funcionar√°.");
          console.error(err);
          return;
        }
      }
      reader = new ZXing.BrowserMultiFormatReader();
      reader.decodeFromVideoElementContinuously($("video"), (res) => {
        if (!res || !scannerAtivo) return;
        const codigo = res.text.trim();
        buffer.push(codigo);
        if (buffer.length > repeticoes) buffer.shift();
        const count = buffer.filter(v => v === codigo).length;
        $("detected").textContent = codigo;
        const pct = (count / repeticoes) * 100;
        const bar = $("barraValidacaoInner");
        bar.style.width = pct + "%";
        bar.textContent = Math.round(pct) + "%";
        $("barraValidacao").setAttribute("aria-valuenow", Math.round(pct));
        if (count >= repeticoes) processarCodigo(codigo);
      });
    }

    function processarCodigo(codigo) {
      navigator.vibrate?.(50);
      scannerAtivo = false;
      beep.play().catch(e => console.warn("Beep n√£o reproduzido:", e));
      const produto = produtos.find(x => x.codigo === codigo);
      setTimeout(() => {
        if (produto) {
          // Substituir prompt por modal no futuro
          const q = prompt(`Produto: ${produto.nome}\nQuantidade:`);
          const qtd = parseInt(q);
          if (qtd > 0) {
            carrinho.push({ ...produto, qtd });
            Storage.set("carrinho", carrinho);
            abrirCarrinho();
          }
        } else {
          alert("Produto n√£o cadastrado.");
        }
        $("barraValidacaoInner").style.width = "0%";
        $("barraValidacao").setAttribute("aria-valuenow", "0");
        scannerAtivo = true;
        buffer = [];
        atualizarCarrinho();
      }, 300);
    }

    function pararScanner() {
      scannerAtivo = false;
      if (reader) reader.reset();
      if (stream) {
        stream.getTracks().forEach(t => t.stop());
        stream = null;
      }
      $("video").srcObject = null;
    }

    // =============== GR√ÅFICO ===============
    function atualizarScannerChart() {
      const ctx = $("categoriaChart");
      if (!ctx) return;

      const categorias = {};
      produtos.forEach(p => {
        categorias[p.categoria] = (categorias[p.categoria] || 0) + 1;
      });

      if (categoriaChart) categoriaChart.destroy();

      const labels = Object.keys(categorias);
      const data = Object.values(categorias);
      const cores = ['#3b7ddd', '#ffb703', '#ff3b3b', '#6b6b6b', '#4caf50', '#9c27b0'];

      categoriaChart = new Chart(ctx, {
        type: 'doughnut',
         {
          labels,
          datasets: [{
            data,
            backgroundColor: cores.slice(0, labels.length)
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    // =============== MODAL CARRINHO (FECHAR COM ESC/CLIQUE FORA) ===============
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && $("modalCarrinho").style.display === 'block') {
        fecharCarrinho();
      }
    });

    $("modalCarrinho").addEventListener('click', (e) => {
      if (e.target === $("modalCarrinho")) {
        fecharCarrinho();
      }
    });

    // =============== INICIALIZA√á√ÉO ===============
    atualizarHistorico();
    atualizarProdutosTable();
    atualizarCarrinho();
    atualizarScannerChart();
  </script>
</body>
</html>
