<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Compras do m√™s</title>

<style>
body{
    font-family: Arial, sans-serif;
    background: linear-gradient(180deg,#eef3ff,#ffffff);
    margin:0;
    padding:0;
}

.container{
    max-width:900px;
    margin:auto;
    padding:15px;
}

.card{
    background:white;
    padding:18px;
    border-radius:16px;
    box-shadow:0 5px 15px rgba(0,0,0,.1);
    margin-top:15px;
}

h1{
    display:flex;
    align-items:center;
    gap:8px;
}

button{
    width:100%;
    padding:14px;
    border-radius:12px;
    border:none;
    font-size:16px;
    margin-top:8px;
    cursor:pointer;
}

.primary{background:#2563ff;color:white;}
.stop{background:#6b7280;color:white;}

#videoContainer{
    width:100%;
    height:260px;
    background:black;
    border-radius:14px;
    overflow:hidden;
    margin-top:10px;
}

video{
    width:100%;
    height:100%;
    object-fit:cover;
}

table{
    width:100%;
    border-collapse:collapse;
}

th,td{
    text-align:left;
    padding:8px;
}

tr:nth-child(even){
    background:#f3f4f6;
}

input,select{
    width:100%;
    padding:12px;
    border-radius:10px;
    border:1px solid #ccc;
    font-size:15px;
}
</style>
</head>

<body>

<div class="container">

<h1>üõí Compras do m√™s</h1>

<div class="card">

<button id="startBtn" class="primary">üì∑ Abrir c√¢mera</button>
<button id="stopBtn" class="stop">‚èπ Parar</button>

<div id="videoContainer">
    <video id="video" playsinline></video>
</div>

<p><strong>C√≥digo detectado:</strong> <span id="detectedCode">‚Äî</span></p>

</div>

<div class="card">
<h2>üì¶ Produtos cadastrados</h2>

<table>
<thead>
<tr>
<th>C√≥digo</th>
<th>Nome</th>
<th>Tipo</th>
<th>Pre√ßo</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="productTable"></tbody>
</table>
</div>

<div class="card">

<h2>‚úèÔ∏è Edi√ß√£o de produto</h2>

<input id="codeInput" placeholder="C√≥digo" readonly>

<input id="nameInput" placeholder="Nome">

<select id="typeInput">
<option value="UN">Unidade (UN)</option>
<option value="KG">Quilo (KG)</option>
</select>

<input id="priceInput" placeholder="Pre√ßo" type="number" step="0.01">

<button class="primary" id="saveBtn">üíæ Salvar altera√ß√µes</button>

</div>

</div>

<script src="https://unpkg.com/@zxing/library@latest"></script>

<script>
let codeReader = new ZXing.BrowserMultiFormatReader();
let currentStream = null;

const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const video = document.getElementById("video");
const detectedCode = document.getElementById("detectedCode");

const codeInput = document.getElementById("codeInput");
const nameInput = document.getElementById("nameInput");
const typeInput = document.getElementById("typeInput");
const priceInput = document.getElementById("priceInput");

const productTable = document.getElementById("productTable");

let products = JSON.parse(localStorage.getItem("products") || "[]");

function renderTable(){
    productTable.innerHTML = "";
    products.forEach((p,i)=>{
        productTable.innerHTML += `
        <tr>
            <td>${p.code}</td>
            <td>${p.name}</td>
            <td>${p.type}</td>
            <td>${p.price}</td>
            <td><button onclick="edit(${i})">Editar</button></td>
        </tr>`;
    });
}
renderTable();

function edit(i){
    let p = products[i];
    codeInput.value = p.code;
    nameInput.value = p.name;
    typeInput.value = p.type;
    priceInput.value = p.price;
}

// iniciar c√¢mera
startBtn.onclick = async ()=>{
    try{
        currentStream = await navigator.mediaDevices.getUserMedia({
            video:{ facingMode:"environment" },
            audio:false
        });

        video.srcObject = currentStream;
        video.play();

        codeReader.decodeFromVideoDevice(null, "video", (result)=>{
            if(result){
                detectedCode.textContent = result.text;

                // üî• auto preencher campo de cadastro
                codeInput.value = result.text;
            }
        });

    }catch(e){
        alert("Erro ao acessar c√¢mera: " + e);
    }
};

// parar c√¢mera
stopBtn.onclick = ()=>{
    if(currentStream){
        currentStream.getTracks().forEach(t=>t.stop());
    }
    codeReader.reset();
};

// salvar edi√ß√£o
document.getElementById("saveBtn").onclick = ()=>{
    let code = codeInput.value;
    if(!code){ alert("Sem c√≥digo"); return; }

    let existing = products.find(p=>p.code === code);

    if(existing){
        existing.name = nameInput.value;
        existing.type = typeInput.value;
        existing.price = priceInput.value;
    }else{
        products.push({
            code,
            name:nameInput.value,
            type:typeInput.value,
            price:priceInput.value
        });
    }

    localStorage.setItem("products", JSON.stringify(products));
    renderTable();

    alert("Salvo com sucesso!");
};
</script>

</body>
</html>
