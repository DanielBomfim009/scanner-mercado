<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Compras do mÃªs</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#eef3ff;
  margin:0;
  padding:0;
  text-align:center;
}

.container{
  padding:20px;
}

.card{
  background:white;
  margin:15px;
  padding:15px;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.08);
}

#video{
  width:100%;
  border-radius:18px;
}

#overlay{
  position:absolute;
  inset:0;
  border:3px solid rgba(0,255,0,0.5);
  border-radius:18px;
  pointer-events:none;
}

button{
  padding:12px 20px;
  margin:6px;
  font-size:15px;
  border-radius:10px;
  border:none;
  cursor:pointer;
}

#btnAbrir{
  background:#2f6bff;
  color:white;
}

#btnParar{
  background:#555;
  color:white;
}
</style>
</head>

<body>

<div class="container">

<h1>ğŸ›’ Compras do mÃªs</h1>

<div class="card">

<button id="btnAbrir">ğŸ“¸ Abrir cÃ¢mera</button>
<button id="btnParar">â¹ Parar</button>

<div style="position:relative; margin-top:10px;">
  <video id="video" autoplay></video>
  <div id="overlay"></div>
</div>

<p><strong>CÃ³digo detectado:</strong> <span id="codigo">â€”</span></p>

</div>

<div class="card">
<h2>ğŸ“¦ Produtos cadastrados</h2>
<p>Aqui continua todo o seu layout normalâ€¦</p>
</div>

</div>

<!-- Beep -->
<audio id="beep">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

<!-- BIBLIOTECA ZXING -->
<script src="https://unpkg.com/@zxing/library@latest"></script>

<script>
const video = document.getElementById("video");
const codigo = document.getElementById("codigo");
const beep = document.getElementById("beep");

let stream = null;

// leitor de mÃºltiplos formatos
const reader = new ZXing.BrowserMultiFormatReader();

// ABRIR CÃ‚MERA
document.getElementById("btnAbrir").onclick = async () => {
  try {

    const devices = await ZXing.BrowserCodeReader.listVideoInputDevices();

    stream = await navigator.mediaDevices.getUserMedia({
      video:{
        deviceId: devices[0]?.deviceId ?? null,
        facingMode:"environment"
      }
    });

    video.srcObject = stream;

    reader.decodeFromVideoDevice(null,"video",(result,err)=>{
      if(result){
        codigo.textContent = result.text;

        // beep
        beep.currentTime = 0;
        beep.play();

        console.log("Detectado:", result.text);
      }
    });

  } catch(e){
    alert("Erro ao iniciar cÃ¢mera: " + e);
  }
};

// PARAR CÃ‚MERA
document.getElementById("btnParar").onclick = () => {
  try{
    if(stream){
      stream.getTracks().forEach(t => t.stop());
    }
    reader.reset();
  }catch(e){
    console.log(e);
  }
};
</script>

</body>
</html>
